/*!
 *
 * @version 1.2.0
 * @desc 不得姐PC 站 js
 * @author xierenhong 
 * @update date 更新时间：2018-02-08 09:15:11 *
 *   * -.-.  .
 * 有注释 只是为了 看看 cdn 是否刷新 然并卵
 *
 */

define("services/util",[],function(){return{params:function(e){var i,t,n,s,o,a,r,d="";for(i in e)if((t=e[i])instanceof Array)for(r=0;r<t.length;++r)o=t[r],n=i+"["+r+"]",a={},a[n]=o,d+=param(a)+"&";else if(t instanceof Object)for(s in t)o=t[s],n=i+"["+s+"]",a={},a[n]=o,d+=param(a)+"&";else void 0!==t&&null!==t&&(d+=encodeURIComponent(i)+"="+encodeURIComponent(t)+"&");return d.length?d.substr(0,d.length-1):d},GA:function(e,i){this.gaSend(e,i,"click")},gaSend:function(e,i,t){ga("send","event",e,i,t)},gaTemp:function(e,i,t,n){return _.template("<%= data.date %>|<%= data.time %>|<%= data.title %>|<%= data.id %>",{variable:"data"})({date:e||"无",time:i||"无",title:t||"无",id:n||"无"})},gaType:function(e,i){return _.template("<%= data.type %>|<%= data.video_mlen %>",{variable:"data"})({type:e,video_mlen:i})},getCookie:function(e){for(var i=document.cookie.split("; "),t=0;t<i.length;t++){var n=i[t].split("=");if(n[0]==e)return unescape(n[1])}return""},delCoolie:function(e){var i=new Date;i.setTime(i.getTime()-1);var t=this.getCookie(e);document.cookie=e+"="+t+"/domain=.budejie.com;path=/;expires="+i.toGMTString()},isWin:function(){return"Win32"==navigator.platform||"Windows"==navigator.platform},isPad:function(){return navigator.userAgent.match(/ipad/gi)},isWinClient:function(){if(this.isWin()){if(/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(navigator.userAgent)){if("NT"!=RegExp.$1)return!1;switch(RegExp.$2){case"6.3":return!0;case"10.0":return console.log("win 10"),!0;default:return!1}}return!1}return!1}}}),define("services/ajax",["services/util"],function(e){return{url:"http://api.budejie.com/api/api_open.php",$post:function(e,i,t){return this.$ajax(this.getConfig(e,i,t,"POST"))},$get:function(e,i,t){return this.$ajax(this.getConfig(e,i,t,"GET"))},$jsonp:function(e,i,t){var n={data:this.getParams(e)+"&callback=?",dataType:"JSONP",url:i};return this.$ajax(_.isObject(t)&&"[object File]"!==String(t)?$.extend({},n,t):n)},getParams:function(i){return _.isObject(i)&&"[object File]"!==String(i)?e.params(i):i},getConfig:function(e,i,t,n){var s=_.isUndefined(i)||i.length<=0?{data:this.getParams(e)+"&callback=?",dataType:"JSONP",xhrFields:{withCredentials:!0}}:{data:this.getParams(e),url:i,type:n};return _.isObject(t)&&"[object File]"!==String(t)?$.extend({},s,t):s},$ajax:function(e){var i=$.Deferred();return $.ajax($.extend({},{type:"GET",url:this.url,dataType:"json"},e)).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()},$ajaxNew:function(e){var i=$.Deferred();return $.ajax($.extend({},{url:"http://d.api.budejie.com/tag/recommend/topic/"+e+"/budejie-android-6.8.0.json",dataType:"jsonp"})).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()}}}),define("services/topic",["services/ajax"],function(e){return{serviceStatic:"http://d.api.budejie.com",getTags:function(i){return e.$ajaxNew(i)},getMyTopic:function(i,t){return e.$jsonp({},this.serviceStatic+"/topic/my-topic/baisishequ-iphone-3.9.1/"+i+"-"+t+".json")},getMyShareTopic:function(i,t,n){return e.$jsonp({},this.serviceStatic+"/topic/share-topic/"+i+"/baisishequ-iphone-8.0/"+t+"-"+n+".json")},getMyCommentTopic:function(i,t,n){return e.$jsonp({},this.serviceStatic+"/comment/user-comment/"+i+"/baisishequ-iphone-8.0/"+t+"-"+n+".json")},delTopic:function(i){return e.$jsonp({},"http://api.budejie.com/api/api_open.php?c=topic&a=deltopic&tid="+i)},delComment:function(i){return e.$jsonp({a:"delete",c:"comment",formart:"json",cid:i,uid:"14397564"},"http://api.budejie.com/api/api_open.php")},getUserTopic:function(i,t,n){return e.$jsonp({},this.serviceStatic+"/topic/user-topic/"+i+"/1/desc/baisishequ-win-1.0/"+t+"-"+n+".json")},sendContent:function(i,t){return e.$jsonp({theme_name:t},"http://api.budejie.com/api/api_open.php?c=topic&a=createugc&type=29&format=json&content="+i)},sendLink:function(i){return e.$jsonp(i,this.serviceStatic+"/topic/push_url_topic")}}}),define("services/message",["dialog"],function(e){return{alert:function(i){e({title:"操作提示",content:i}).show()},msg:function(i,t){var n=t||2e3,s=e({skin:"j-msg",title:"操作提示",content:i});s.show(),setTimeout(function(){s.close().remove()},n)}}}),define("services/widget/uploadfile",["services/message"],function(e){function i(e,t){this.$id=$(e),this.config=$.extend({},i.DEFAULTS.options,t),this.$id.length>0&&this._init(),this.$fileUpload=null,this.$beforeUploadContain=$("#beforeUploadContain"),this.$afterUploadContain=$("#afterUploadContain"),this.$btnUploadDel=$("#btnUploadDel"),this.$btnSubmit=$("#btnSubmit"),this.$txtUploadFileName=$("#txtUploadFileName")}return i.DEFAULTS={options:{xhrFields:{withCredentials:!0},disableImageResize:!0,previewMaxWidth:60,previewMaxHeight:60,previewCrop:!0,dataType:"json",autoUpload:!1,messages:{maxNumberOfFiles:"超过了最大数量的文件！",acceptFileTypes:"你上传的文件不支持哦!",maxFileSize:"文件太大了！",minFileSize:"文件太小了！"}}},i.prototype._init=function(){this.$id.fileupload(this.config),this._fail(),this._always()},i.prototype._fail=function(){this.$id.on("fileuploadfail",function(i,t){"abort"!=t.errorThrown&&(e.msg("上传失败,请稍后重试！"),$("#tabContainer").unblock())})},i.prototype.add=function(e){var i=this;this.$id.on("fileuploadadd",function(t,n){return e?void e.call(this,{e:t,data:n}):(i.$beforeUploadContain.hide(),i.$afterUploadContain.show(),i.$txtUploadFileName.show().text(n.files[0].name),i.$btnUploadDel.show().data(n),i.$btnSubmit.prop("disabled",!1).data(n),void i.del())})},i.prototype._always=function(){var i=this;i.$id.on("fileuploadprocessalways",function(t,n){var s=n.index,o=n.files[s];o.error&&e.msg(o.error),o.preview&&"image"==n.paramName&&i.$afterUploadContain.find(".j-tab-c-file-ing-l").html(o.preview),s+1===n.files.length&&i.$btnSubmit.prop("disabled",!!n.files.error)})},i.prototype.del=function(){var e=this;e.$btnUploadDel.on("click",function(){var i=e.$btnUploadDel.data();e.$beforeUploadContain.show(),e.$afterUploadContain.hide(),e.$txtUploadFileName.text("").hide(),e.$btnSubmit.prop("disabled",!0),i.abort()})},i}),define("services/widget/voice.uploadfile",["services/message"],function(e){function i(e,t){this.$id=$(e),this.config=$.extend({},i.DEFAULTS.options,t),this.$id.length>0&&this._init(),this.$btnSubmit=$("#btnSubmit"),this.$fileAddBimage=$("#fileAddBimage"),this.$fileBimageC=$("#fileBimageC"),this.$fileAddVoice=$("#fileAddVoice"),this.$fileVoiceC=$("#fileVoiceC"),this.$txtUploadFileNameImg=$("#txtUploadFileNameImg"),this.$txtUploadFileNameVoice=$("#txtUploadFileNameVoice")}return i.DEFAULTS={options:{xhrFields:{withCredentials:!0},disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:60,previewMaxHeight:60,previewCrop:!0,dataType:"json",autoUpload:!1,messages:{maxNumberOfFiles:"超过了最大数量的文件！",acceptFileTypes:"你上传的文件不支持哦!",maxFileSize:"文件太大了！",minFileSize:"文件太小了！"}}},i.prototype._init=function(){this.file=this.$id.fileupload(this.config),this._always(),this._fail()},i.prototype._fail=function(){this.$id.on("fileuploadfail",function(i,t){console.log("data.errorThrown",t.errorThrown),"abort"!=t.errorThrown&&(e.msg("上传失败,请稍后重试！"),$("#tabContainer").unblock())})},i.prototype.add=function(i){var t=this;this.$id.on("fileuploadadd",function(n,s){if(i)return void i.call(this,{e:n,data:s});var o=s.paramName,a=s.files[0].name;if("bimage"==o){if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(a))return e.msg("封面图类型必须是.gif,jpeg,jpg,png中的一种"),void s.abort();t.$fileBimageC.data(o,{data:s}),t.$fileAddBimage.hide(),t.$fileBimageC.show(),t.$txtUploadFileNameImg.show().text(a),t._bImageDel()}if("voice"==o){if(!/\.(mp3|MP3)$/.test(a))return e.msg("声音暂时只支持MP3格式"),void s.abort();t.$fileVoiceC.data(o,{data:s}),t.$fileAddVoice.hide(),t.$fileVoiceC.show(),t.$txtUploadFileNameVoice.show().text(a),t._voiceDel()}t.$btnSubmit.prop("disabled",!1)})},i.prototype._always=function(){var i=this;i.$id.on("fileuploadprocessalways",function(t,n){var s=n.index,o=n.files[s];o.error&&e.msg(o.error),o.preview&&"bimage"==n.paramName&&i.$fileBimageC.find(".j-tab-c-file-ing-l").html(o.preview),s+1===n.files.length&&i.$btnSubmit.prop("disabled",!!n.files.error)})},i.prototype._bImageDel=function(){var e=this;$("#btnFileBimageDel").unbind().on("click",function(){var i=e.$fileBimageC.data("bimage").data;console.log("删除",i),i.abort(),e.$fileAddBimage.show(),e.$fileBimageC.hide(),e.$btnSubmit.prop("disabled",!0),e.$fileBimageC.data("bimage",{}),e.$txtUploadFileNameImg.hide().text("")})},i.prototype._voiceDel=function(){var e=this;$("#btnFileVoiceDel").unbind().on("click",function(){e.$fileVoiceC.data("voice").data.abort(),e.$fileAddVoice.show(),e.$fileVoiceC.hide(),e.$btnSubmit.prop("disabled",!0),e.$fileVoiceC.data("voice",{}),e.$txtUploadFileNameVoice.hide().text("")})},i}),define("module/user/user.publish",["services/topic","services/widget/uploadfile","services/widget/voice.uploadfile","services/message"],function(e,i,t,n){function s(){this.$txtTags=$("#txtTags"),this.$textArea=$("#textArea"),this.$tabContainer=$("#tabContainer"),this.init(),this.file=null}return s.prototype.init=function(){this.tagsInit(),this.uploadsInit(),$("input, textarea").placeholder()},s.prototype.textareaEvent=function(){var e=$("#textArea");e.focus(function(){"说个又逗逼又新鲜的事......"==$(this).val()&&$(this).val("")}),e.blur(function(){""==$(this).val()&&$(this).val("说个又逗逼又新鲜的事......")});var i=$("#txtLink");i.length>0&&(i.focus(function(){"请输入或者粘贴一个网站"==$(this).val()&&$(this).val("")}),i.blur(function(){""==$(this).val()&&$(this).val("请输入或者粘贴一个网站")}))},s.prototype.tagsInit=function(){this.$txtTags.tagsinput({maxTags:5,maxChars:8,confirmKeys:[13,44,32,188],trimValue:!0}),this.tagsRecommendListBind()},s.prototype.tagsRecommendListBind=function(){var i=this,t=$("#listRecommendTags");e.getTags(i.getType()).then(function(e){if(e.list){var n=_.filter(e.list,function(e,i){return i<=11}),s=_.map(n,function(e,t){var n=e.theme_name;return-1!=_.indexOf(i.$txtTags.val().split(","),n)?'<li class="active">'+n+"</li>":"<li>"+n+"</li>"}),o=$(s.join(""));t.html("").append(o),o.on("click",function(){var e=$(this),t=i.$txtTags.val().split(","),n=e.text();-1!=_.indexOf(t,n)?!e.hasClass("active")&&e.addClass("active"):5!=t.length&&(i.$txtTags.tagsinput("add",e.text()),e.addClass("active"))})}}),i.$txtTags.on("beforeItemRemove",function(e){var i=e.item;$.each(t.find("li"),function(){var e=$(this);e.text()==i&&e.hasClass("active")&&e.removeClass("active")})})},s.prototype.getType=function(){switch(JIE.topicType){case"voice":return 31;case"video":return 41;case"image":return 10;case"text":return 29;default:return 41}},s.prototype.uploadsInit=function(){if("voice"==JIE.topicType){var e=new t("#fileUpload",{url:"http://up.api.budejie.com/api/api_open.php?c=topic&a=createugc",maxFileSize:1e8});return e.add(),void this._voiceSubmit(e)}return"text"==JIE.topicType?void this._textSubmit():"link"==JIE.topicType?void this._linkSumbit():(this.file=new i("#fileUpload",{url:"http://up.api.budejie.com/api/api_open.php?c=topic&a=createugc",acceptFileTypes:"video"==JIE.topicType?/(\.|\/)(mp4)$/i:/(\.|\/)(gif|jpg|jpeg|png)$/i,maxFileSize:"video"==JIE.topicType?1e8:1e7}),this.file.add(),void this.submit())},s.prototype._voiceSubmit=function(e){var i=this,t=[],s=[];e.$btnSubmit.on("click",function(){if(ga("send","event","pc官网-发声音","点击投稿button",""),i.valid()){var o=e.$fileBimageC.data("bimage"),a=o&&o.data,r=e.$fileVoiceC.data("voice"),d=r&&r.data;if(_.isUndefined(o)||_.isUndefined(a))return n.msg("你还未上传封面图！"),!1;if(_.isUndefined(r)||_.isUndefined(d))return n.msg("你还未上传声音！"),!1;t.push(a.files[0]),s.push(a.paramName),t.push(d.files[0]),s.push(d.paramName),i.$tabContainer.block({message:'<div style="background:#fff;height: 90px;padding-top: 10px;"><img src="http://img.spriteapp.cn/huodong/loading.gif" style="width:90px;" /> <h1 style="color:#000; font-weight:normal;font-size:14px;" >发帖中请稍候...</h1></div>',css:{background:"none",border:"0"}}),e.$id.fileupload("send",{files:t,paramName:s,formData:{format:"json",theme_name:i.$txtTags.val(),type:31,content:i.$textArea.val()}}).success(function(e){i._afterSumbit(e)}).error(function(){ga("send","event","pc官网-发声音","提交失败",""),n.msg("网络超时,请稍后重试！")}).complete(function(){i.$tabContainer.unblock()})}})},s.prototype._textSubmit=function(){var i=this;$("#btnSubmit").on("click",function(){ga("send","event","pc官网-发段子","点击投稿button","");var t=i.$textArea.val();return t.length<=4?(n.msg("描述不能小于5个字！"),!1):i.$txtTags.val().length<=0?(n.msg("hi,你还没有选择标签哦！"),!1):(i.$tabContainer.block({message:'<div style="background:#fff;height: 90px;padding-top: 10px;"><img src="http://img.spriteapp.cn/huodong/loading.gif" style="width:90px;" /> <h1 style="color:#000; font-weight:normal;font-size:14px;" >发帖中请稍候...</h1></div>',css:{background:"none",border:"0"}}),void e.sendContent(t,i.$txtTags.val()).then(function(e){i._afterSumbit(e),i.$tabContainer.unblock()},function(e){ga("send","event","pc官网-发段子","提交失败",""),n.msg("网络超时,请稍后重试！"),i.$tabContainer.unblock()}))})},s.prototype._linkSumbit=function(){var i=this;$("#btnSubmit").on("click",function(){ga("send","event","pc官网-发链接","点击投稿button","");var t=i.$textArea.val(),s=$("#txtLink"),o=s.val();return s.length<=0||!/(https?|ftp|mms):\/\/([A-z0-9]+[_\-]?[A-z0-9]+\.)*[A-z0-9]+\-?[A-z0-9]+\.[A-z]{2,}(\/.*)*\/?/.test(o)?void n.msg("输入的网站不符合规则！"):t.length<=4?void n.msg("描述不能小于5个字！"):i.$txtTags.val().length<=0?(n.msg("hi,你还没有选择标签哦！"),!1):(i.$tabContainer.block({message:'<div style="background:#fff;height: 90px;padding-top: 10px;"><img src="http://img.spriteapp.cn/huodong/loading.gif" style="width:90px;" /> <h1 style="color:#000; font-weight:normal;font-size:14px;" >发帖中请稍候...</h1></div>',css:{background:"none",border:"0"}}),void e.sendLink({title:t,url:o,theme_name:i.$txtTags.val()}).then(function(e){n.msg(e.message),200==e.code&&(ga("send","event","pc官网-发链接","提交成功",""),window.location.href="/user/topic/"),i.$tabContainer.unblock()},function(e){ga("send","event","pc官网-发链接","提交失败",""),n.msg("网络超时,请稍后重试！"),i.$tabContainer.unblock()}))})},s.prototype.valid=function(){return this.$textArea.val().length<=4?(n.msg("描述不能小于5个字！"),!1):!(this.$txtTags.val().length<=0&&(n.msg("hi,你还没有选择标签哦！"),1))},s.prototype._afterSumbit=function(e){e?(n.msg(e.result_desc),0==e.result?("voice"==JIE.topicType&&ga("send","event","pc官网-发声音","提交成功",""),"video"==JIE.topicType&&ga("send","event","pc官网-发视频","提交成功",""),"image"==JIE.topicType&&ga("send","event","pc官网-发图片","提交成功",""),"text"==JIE.topicType&&ga("send","event","pc官网-发段子","提交成功",""),window.location.href="/user/topic/"):("voice"==JIE.topicType&&ga("send","event","pc官网-发声音","提交失败",""),"video"==JIE.topicType&&ga("send","event","pc官网-发视频","提交失败",""),"image"==JIE.topicType&&ga("send","event","pc官网-发图片","提交失败",""),"text"==JIE.topicType&&ga("send","event","pc官网-发段子","提交失败",""))):(n.msg("你使用的浏览器版本过低！无法知道是否上传成功！"),window.location.href="/user/topic/")},s.prototype.submit=function(){var e=$("#btnSubmit"),i=this;e.on("click",function(){"video"==JIE.topicType&&ga("send","event","pc官网-发视频","点击投稿button",""),"image"==JIE.topicType&&ga("send","event","pc官网-发图片","点击投稿button","");var t=e.data();return _.isUndefined(t.submit)?void n.msg("hi,还未选择上传文件！"):void(i.valid(t)&&(t.formData={format:"json",theme_name:i.$txtTags.val(),type:"video"==JIE.topicType?41:10,content:i.$textArea.val()},i.$tabContainer.block({message:'<div style="background:#fff;height: 90px;padding-top: 10px;"><img src="http://img.spriteapp.cn/huodong/loading.gif" style="width:90px;" /> <h1 style="color:#000; font-weight:normal;font-size:14px;" >发帖中请稍候...</h1></div>',css:{background:"none",border:"0"}}),t.submit().success(function(e){i._afterSumbit(e)}).error(function(){ga("send","event","pc官网-发视频","提交失败",""),n.msg("网络超时,请稍后重试！")}).complete(function(){i.$tabContainer.unblock()})))})},s}),define("module/user/validate",[],function(){return{common:function(){return{errorPlacement:function(e,i){i.parents(".j-u-c-input").addClass("j-v-error").after(e)},success:function(e){var i=e.prev();i.hasClass("j-v-error")&&i.removeClass("j-v-error"),e.remove()}}}}}),define("services/user/user.service",["services/ajax"],function(e){return{serviceStatic:"http://d.api.budejie.com",login:function(i,t){return e.$jsonp({phonenum:i,password:md5(t)},this.serviceStatic+"/user/login")},register:function(i,t,n){return e.$jsonp({username:i,password:md5(t),verify_code:n},this.serviceStatic+"/user/register")},restPwd:function(i,t){return e.$jsonp({password:md5(i),re_password:md5(t)},this.serviceStatic+"/user/reset_password")},findPwd:function(i,t,n){return e.$jsonp({username:i,password:md5(t),verify_code:n},this.serviceStatic+"/user/register")},sendCode:function(i,t,n){return e.$jsonp({phonenum:i,verifytype:t,code:n},this.serviceStatic+"/user/getverifycode")},checkVerify:function(i,t){return e.$jsonp({phonenum:i,verify_code:t,verifytype:"reset_password"},this.serviceStatic+"/user/checkverify")},loginOut:function(){return e.$jsonp({client:"pc"},this.serviceStatic+"/user/logout")},getInfo:function(){return e.$jsonp({},this.serviceStatic+"/user/profile")},getUserInfoById:function(i){return e.$jsonp({a:"profile",c:"user",userid:i},"http://api.budejie.com/api/api_open.php")},getFansList:function(i,t){return e.$jsonp({a:"fans_list",c:"user",follow_id:t,userid:i},"http://api.budejie.com/api/api_open.php")},getFollowList:function(i,t){return e.$jsonp({a:"follow_list",c:"user",follow_id:t,userid:i},"http://api.budejie.com/api/api_open.php")},follow:function(i){return e.$jsonp({a:"follow",c:"user",userid:i},"http://api.budejie.com/api/api_open.php")},unFollow:function(i){return e.$jsonp({a:"unfollow",c:"user",userid:i},"http://api.budejie.com/api/api_open.php")},getNewsList:function(i,t,n,s){return e.$jsonp({a:"msgcenter",c:"msg",appname:"baisishequ",from:"www",page:t,per:n,uid:i,max:s,ver:"4.0",client:"ios"},"http://api.budejie.com/api/api_open.php")}}}),define("module/user/user.info",["services/user/user.service","services/message","dialog","services/util"],function(e,i,t,n){function s(){this.getInfo(),this.$loginBar=$("#jLoginBar"),this.$jUserLoginBar=$("#jUserLoginBar"),this.$userInfo=$("#userInfo"),this.$userFollow=$("#userFollow"),this.$userFans=$("#userFans"),this.$userNewsIcon=$("#userNewsIcon"),this.$userNewsHtml="",this.$jTitle=$("#jTitle"),this.location=window.location}function o(e){var i=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==i||i.length<1?null:i[1]}return s.prototype.getInfo=function(){var i=e.getUserInfoById(),t=this;i.then(function(e){if(e&&(t._rightUserInfo(e),t._rightUserFollow(e),t._rightUserFans(e),t._topUserNews(e),t.auth(e),0==e.code)){var i=_.escape(e.data.username);t.bind(i.length>9?i.substring(0,8)+"...":i,i)}})},s.prototype._len=function(e){return e.replace(/[^\x00-\xff]/g,"**").length},s.prototype.bind=function(e,i){console.log(e),this.$loginBar.hide(),this.$jUserLoginBar.find("#jUserLoginName").text(e).attr("title",i),this.$jUserLoginBar.show(),this._event()},s.prototype._event=function(){var n=$("#jLoginExit"),s=this;n.length>0&&n.on("click",function(){e.loginOut().then(function(e){e&&0==e.result&&(i.msg(e.result_desc),s.$loginBar.show(),s.$jUserLoginBar.hide(),s.location.reload())})}),s.$userNewsIcon.length>0&&s.$userNewsIcon.on("click",function(){t({padding:0,quickClose:!0,content:s.$userNewsHtml}).show(document.getElementById("userNewsIcon"))})},s.prototype.auth=function(e){var i=this;if(0!=e.code&&"True"==jie.is_oauth_login&&(i.location.href="/user/login?r_url="+encodeURI(i.location.href)),0==e.code&&"True"==jie.is_login_page){var t=o("r_url");i.location.href=null!=t?t:"http://www.budejie.com"}},s.prototype._rightUserInfo=function(i){var t=this;if(t.$userInfo.length>0)if(window.JIE=window.JIE||{},!_.isUndefined(JIE.userId)&&JIE.userId.length>0)e.getUserInfoById(JIE.userId).then(function(e){if(e){e.data.username=_.escape(e.data.username),e.data.introduction=_.escape(e.data.introduction);var i=_.template(t._rightOtherUserInfoTemp(),{variable:"user"}),n=i(e.data);t.$userInfo.html(n),t._followEvent(),t._updateTitle(e.data.username)}});else if(0==i.code){i.data.username=_.escape(i.data.username),i.data.introduction=_.escape(i.data.introduction);var n=_.template(t._rightUserInfoTemp(),{variable:"user"}),s=n(i.data);t.$userInfo.html(s),t._updateTitle(i.data.username)}},s.prototype._rightUserFollow=function(i){var t=this;if(t.$userFollow.length>0){window.JIE=window.JIE||{};var n=0,s=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(n=JIE.userId,s=!0):(n=i.id,s=!1);e.getFollowList(n,0).then(function(e){if(e&&0==e.code){var i=e.data;i.list=$(i.list).slice(0,5);for(var n=0;n<i.list.length;n++)i.list[n].username=_.escape(i.list[n].username),i.list[n].username.length>3&&(i.list[n].username=i.list[n].username.substring(0,2)+"...");i.isOthers=s;var o=_.template(t._rightUserFollowTemp(),{variable:"follow"}),a=o(i);t.$userFollow.html(a)}})}},s.prototype._rightUserFans=function(i){var t=this;if(t.$userFans.length>0){window.JIE=window.JIE||{};var n=0,s=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(n=JIE.userId,s=!0):(n=i.id,s=!1);e.getFansList(n,0).then(function(e){if(e&&0==e.code){var i=e.data;i.list=$(i.list).slice(0,5);for(var n=0;n<i.list.length;n++)i.list[n].username=_.escape(i.list[n].username),i.list[n].username.length>3&&(i.list[n].username=i.list[n].username.substring(0,2)+"...");i.isOthers=s;var o=_.template(t._rightUserFansTemp(),{variable:"fans"}),a=o(i);t.$userFans.html(a)}})}},s.prototype._topUserNews=function(i){var t=this;if(t.$userNewsIcon.length>0){e.getNewsList(i.data.id,1,5,0).then(function(e){if(e){var i=_.template(t._topUserNewsTemp(),{variable:"news"}),n=i(_.map(e.list,function(e){var i={};return i.ctime=e.ctime,"url_topic"==e.type||"system"==e.type?i.title="系统消息:"+_.escape(e.body):i.title=_.escape(e.title),i.title.length>14&&(i.title=_.escape(i.title.substring(0,14))+"..."),e.pinfo&&(i.id=e.pinfo.id),i}));t.$userNewsHtml=n}})}},s.prototype._followEvent=function(){var t=this;t.$userInfo.find(".j-follow").on("click",function(){var s=$(this),o=s.data("userid");n.gaSend("pc官网-关注好友","点击关注button",""),t._isLogin(function(){e.follow(o).then(function(e){console.log(e),s.hide(),s.next().show(),i.msg(e.msg)})})}),t.$userInfo.find(".j-un-follow").on("click",function(){var s=$(this),o=s.data("userid");n.gaSend("pc官网-取消关注好友","点击取消关注button",""),t._isLogin(function(){e.unFollow(o).then(function(e){console.log(e),s.hide(),s.prev().show(),i.msg(e.msg)})})})},s.prototype._rightUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/topic/" title="<%= user[\'username\'] %>" class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},s.prototype._rightOtherUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/others-<%= user[\'id\'] %>.html"  title="<%= user[\'username\'] %>"  class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n        <%if (user.relationship == \'0\' || user.relationship == \'3\' ) { %>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow">+ 关注</a>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow" style="display: none;">取消关注</a>\n        <% } %>\n        <%if (user.relationship == \'2\' || user.relationship == \'4\') { %>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow"  style="display: none;">+ 关注</a>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow">取消关注</a>\n        <% } %>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},s.prototype._rightUserFollowTemp=function(){return'<div class="p-age-attente-title"><span>关注（<%= follow[\'info\'][\'count\']%>人）</span><a href="/user/follow/<%= follow.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(follow[\'list\']) > 0) { _.each(follow[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有关注人哦</li><% } %></ul>'},s.prototype._rightUserFansTemp=function(){return'<div class="p-age-attente-title"><span>粉丝（<%= fans[\'info\'][\'count\']%>人）</span><a href="/user/fans/<%= fans.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(fans[\'list\']) > 0) { _.each(fans[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有粉丝哦</li><% } %></ul>'},s.prototype._topUserNewsTemp=function(){return"<div class=\"j-new-box\"><ul><% if (_.size(news) > 0) { _.each(news, function(item) { %><li><a href=\"<%= item['id'] == undefined ? '/user/news' : '/detail-' + item['id'] + '.html' %>\"><%= item['title']%></a></li><% });} else { %><li class=\"j-new-none-msg\">没有消息提醒</li><% } %><li class=\"j-new-more\"><a href=\"/user/news\">查看更多</a></li></ul></div>"},s.prototype._isLogin=function(i){e.getInfo().then(function(e){1==e.code?(window.JIE=window.JIE||{},JIE.openLoginDialog()):i&&i.call()})},s.prototype._updateTitle=function(e){this.$jTitle.length>0&&(window.JIE=window.JIE||{},JIE.isUpdateTitle&&this.$jTitle.text(this.$jTitle.text().replace("@userName@",e)))},s}),define("module/user/findpwd",["dialog","services/ajax","module/user/validate","services/user/user.service","services/message","module/user/user.info"],function(e,i,t,n,s,o){function a(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return a.prototype.open=function(){var i=this,t=e.get("j-find");if(!_.isUndefined(t))return void t.showModal();i.dlg=new e({id:"j-find",fixed:!0,innerHTML:this.temp(),height:340,width:594}),i.dlg.showModal(),i.event();var n=i.validate();i.sendCode(n),$("input, textarea").placeholder()},a.prototype.opens=function(){var i=this,t=e.get("j-finds");if(!_.isUndefined(t))return void t.showModal();this.dlg=new e({id:"j-finds",fixed:!0,innerHTML:this.temps(),height:340,width:594}),i.dlg.showModal(),$("#jFindDCles").on("click",function(){i.dlg.close()}),i.validates(),$("input, textarea").placeholder()},a.prototype.temp=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFind">\n                <div class="j-u-d-c-one  j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span>+86 <input type="text" placeholder="请输入手机号" name="username" class="j-u-d-c-p-con j-findpwd-telephone" id="findTxtUserName">\n                    </div>\n                    </div>\n                <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符"  name="vcode" class="j-u-d-c-p-con" id="txtFindVCode">\n                    </div><div id="jFindVCode" class="j-u-d-c-vcode"><img id="jFindVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div>\n                </div><div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"  name="code" class="j-u-d-c-p-con" id="findCode">\n                    </div>\n                <div class="j-u-d-c-code" id="jGetCode">获取验证码</div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindSubmit" class="j-u-d-submit j-code-submit">提交</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.temps=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCles"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFinds">\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password" placeholder="请输入密码" class="j-u-d-c-p-con" name="password" id="password">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">确认密码 |  </span><input type="password" placeholder="请再次输入密码确认" class="j-u-d-c-p-con" name="apassword" id="apassword">\n                    </div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindsSubmit" class="j-u-d-submit">确定</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.event=function(){var e=this;$("#jFindDCle").on("click",function(){e.dlg.close()})},a.prototype.sendCode=function(e){var i=this,t=$("#jFindVCodeImg");t.attr("src",i.vCodeUrl+"?t="+(new Date).getTime()),$("#jFindVCode").on("click",function(){t.attr("src",i.vCodeUrl+"?t="+(new Date).getTime())}),$("#jGetCode").on("click",function(){var o=$.trim($("#findTxtUserName").val()),a=$.trim($("#txtFindVCode").val());if(o.length<=0||!/^1\d{10}$/.test(o))return void e.element("#findTxtUserName");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtFindVCode");if(!(i.seconds>0&&i.seconds<60||i.codeIsSend)){n.sendCode(o,"reset_password",a).then(function(e){e&&(0==e.code?(s.msg("验证码发送成功！"),i.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,s.msg("提示:"+e.msg),t.attr("src",i.vCodeUrl+"?t="+(new Date).getTime())))})}})},a.prototype.disabledSendBtn=function(){var e=$("#jGetCode"),i=this,t=setInterval(function(){i.seconds--,e.text(i.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==i.seconds&&(clearInterval(t),i.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),i.codeIsSend=!1)},1e3)},a.prototype.validate=function(){var e=this,i=$("#ffFind"),t=i.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",
iphone:"手机号错误"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,i){i.parents(".j-u-d-f-input").addClass("j-v-error").parents(".j-u-d-c-code").after(e)},success:function(e){var i=e.prev().find(".j-u-d-f-input");i.hasClass("j-v-error")&&i.removeClass("j-v-error"),e.remove()}});return $("#btnFindSubmit").on("click",function(){if(i.valid()){var o=$("#findTxtUserName"),a=$("#findCode");t.resetForm();n.checkVerify(o.val(),a.val()).then(function(i){i&&(1e3==i.code?(e.dlg.close(),e.opens()):(i.msg="验证码错误"==i.msg?"短信验证码错误":i.msg,s.msg("提示:"+i.msg)))},function(){s.msg("网络超时,请稍后重试！")})}}),i.keydown(function(e){13==e.keyCode&&$("#btnFindSubmit").trigger("click")}),t},a.prototype.validates=function(){var e=$("#ffFinds"),i=e.validate($.extend({},t.common(),{rules:{password:{required:!0,minlength:6,maxlength:16},apassword:{required:!0,equalTo:"#password"}},messages:{password:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"},apassword:{required:"密码不能为空",equalTo:"两次输入的密码不一致,请重新输入"}}}));return $("#btnFindsSubmit").on("click",function(){if(e.valid()){var t=$("#password"),o=$("#apassword");i.resetForm();n.restPwd(t.val(),o.val()).then(function(e){e&&(1e3==e.code?(s.msg("修改密码成功"),window.location.reload()):s.msg(e.msg))},function(){s.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&$("#btnFindsSubmit").trigger("click")}),i},a}),define("module/user/login",["dialog","module/user/findpwd","services/util","module/user/validate","module/user/user.info","services/user/user.service","services/message"],function(e,i,t,n,s,o,a){function r(){this.dlg=null}return r.prototype.open=function(){var i=this,t=e.get("j-Login");return _.isUndefined(t)?(i.dlg=new e({id:"j-Login",fixed:!0,innerHTML:this.temp(),height:393,width:740}),i.dlg.showModal(),i.event(),$("input.j-u-d-c-p-con").placeholder(),i.remindMe(),i.findPwd(),void i.validate()):void t.showModal()},r.prototype.close=function(){this.dlg.close()},r.prototype.temp=function(){return'<div class="j-ui-dialog j-regist j-login" >\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">登录</div>\n        <span class="j-u-d-h-close" id="jLoginDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffLogin">\n                <div class="j-u-d-c-one j-u-d-c-spe">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                            <span class="j-u-d-c-p-tit">账&nbsp;&nbsp;&nbsp;&nbsp;号 |  </span>\n                            <input id="txtUserName" name="username" type="text" placeholder="手机号" class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input id="txtUserPwd" name="userpwd" type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me" id="jRemindMe">\n                        <span class="icon-checkbox "></span>\n                        &nbsp;&nbsp;姐，记住我\n                    </label>\n                    <a class="forget-password" id="jForgetPwd">忘记密码</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit j-u-d-login">登录</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-regist-des">还没有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_L_Register">注册</span>\n            </div>\n        </div>\n    </div>\n</div>'},r.prototype.event=function(){var e=this;$("#jLoginDCle").on("click",function(){e.dlg.close()})},r.prototype.remindMe=function(){var e=$("#jRemindMe"),i=e.find("span.icon-checkbox"),t=$.cookie("bdj_username"),n=$("#txtUserName"),s=$("#txtUserPwd");void 0!=t&&(!i.hasClass("icon-checkbox-click")&&i.addClass("icon-checkbox-click"),n.val(t),s.val($.cookie("bdj_user_pwd"))),e.on("click",function(){i.hasClass("icon-checkbox-click")?(i.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"})):(i.addClass("icon-checkbox-click"),$.cookie("bdj_username",n.val(),{path:"/"}),$.cookie("bdj_user_pwd",s.val(),{path:"/"}))}),n.keyup(function(){!/^1\d{10}$/.test($(this).val())&&i.hasClass("icon-checkbox-click")&&(i.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"}))})},r.prototype.findPwd=function(){var e=this;$("#jForgetPwd").on("click",function(){e.dlg.close(),(new i).open(),t.gaSend("pc官网-点击忘记密码","忘记密码","")})},r.prototype.validate=function(){var e=$("#ffLogin"),i=$(".j-u-d-login"),s=e.validate($.extend({},n.common(),{rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:6,maxlength:16}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"}}}));i.on("click",function(){if(e.valid()){var i=$("#txtUserName"),n=$("#txtUserPwd");s.resetForm();o.login(i.val(),n.val()).then(function(e){e&&(1e3==e.code?(a.msg("登录成功"),t.gaSend("pc官网-点击登录","登录成功",""),window.location.reload()):a.msg(e.msg))},function(){a.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&i.trigger("click")})},r}),define("module/user/register",["dialog","module/user/user.info","services/user/user.service","services/message"],function(e,i,t,n){function s(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.isAgree=!0,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return s.prototype.open=function(){var i=this,t=e.get("j-register");if(!_.isUndefined(t))return void t.showModal();i.dlg=new e({id:"j-register",fixed:!0,innerHTML:this.temp(),height:454,width:772}),i.dlg.showModal(),i.event();var n=i.validate();i.sendCode(n)},s.prototype.close=function(){this.dlg.close()},s.prototype.temp=function(){return'<div class="j-ui-dialog j-regist">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">注册 我要做姐粉</div>\n        <span class="j-u-d-h-close" id="jRegisterDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffRegister">\n                <div class="j-u-d-c-one j-u-d-c-spe j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span><input type="text" placeholder="请输入手机号"\n                                                                         class="j-u-d-c-p-con" name="username" id="txtUserRegistTelephone">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con" name="userpwd"  id="txtUserRegistPwd" >\n                    </div>\n                </div>\n       <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register"><div class="j-u-d-c-phone j-u-d-fl j-u-c-input"><span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符" class="j-u-d-c-p-con" name="vcode" id="txtRegVCode"></div><div id="jRegVCode" class="j-u-d-c-vcode"><img id="jRegVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div></div>\n         <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-d-fl j-u-c-input">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"\n                                                                         class="j-u-d-c-p-con"  name="code" id="txtUserRegistCode">\n                    </div>\n                    <div class="j-u-d-c-code" id="jRegistGetCode">获取验证码</div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me">\n                        <span class="icon-checkbox icon-checkbox-click"></span>\n                        &nbsp;&nbsp;签署姐的\n                    </label><a href="http://www.budejie.com/budejie/privacy.html" target="_block" class="j-u-d-privacy">注册协议</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit" id="btnRegister">注册</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-login-des">已有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_R_Login">登录</span>\n            </div>\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n'},s.prototype.event=function(){var e=this;$("#jRegisterDCle").on("click",function(){e.dlg.close()}),$("input, textarea").placeholder();var i=$("#btnRegister");$(".remind-me").click(function(){$(this).find("span").hasClass("icon-checkbox-click")?($(this).find("span").removeClass("icon-checkbox-click"),e.isAgree=!1,i.addClass("j-u-d-submit-disabled")):($(this).find("span").addClass("icon-checkbox-click"),e.isAgree=!0,i.removeClass("j-u-d-submit-disabled"))})},s.prototype.sendCode=function(e){var i=this,s=$("#jRegVCodeImg");s.attr("src",i.vCodeUrl+"?t="+(new Date).getTime()),$("#jRegVCode").on("click",function(){s.attr("src",i.vCodeUrl+"?t="+(new Date).getTime())}),$("#jRegistGetCode").on("click",function(){var o=$.trim($("#txtUserRegistTelephone").val()),a=$.trim($("#txtRegVCode").val());if(o.length<=0||!/^1\d{10}$/.test(o))return void e.element("#txtUserRegistTelephone");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtRegVCode");if(!(i.seconds>0&&i.seconds<60||i.codeIsSend)){t.sendCode(o,"register",a).then(function(e){e&&(0==e.code?(n.msg("验证码发送成功！"),i.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,n.msg("提示:"+e.msg),s.attr("src",i.vCodeUrl+"?t="+(new Date).getTime())))})}})},s.prototype.disabledSendBtn=function(){var e=$("#jRegistGetCode"),i=this,t=setInterval(function(){i.seconds--,e.text(i.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==i.seconds&&(clearInterval(t),i.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),i.codeIsSend=!1)},1e3)},s.prototype.validate=function(){var e=this,i=$("#ffRegister"),s=$("#btnRegister"),o=i.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:8,maxlength:16},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持8-16位数字、字母和符号",maxlength:"密码仅支持8-16位数字、字母和符号"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,i){i.parents(".j-u-c-input").addClass("j-v-error").parents(".j-u-d-c-register").after(e)},success:function(e){var i=e.prev().find(".j-u-c-input");i.hasClass("j-v-error")&&i.removeClass("j-v-error"),e.remove()}});return s.on("click",function(){if(e.isAgree&&i.valid()){var s=$("#txtUserRegistTelephone"),a=$("#txtUserRegistPwd"),r=$("#txtUserRegistCode");o.resetForm();t.register(s.val(),a.val(),r.val()).then(function(e){console.log(e),e&&(1e3==e.code?(n.msg("注册成功"),ga("send","event","pc官网-点击注册","注册成功",""),window.location.reload()):(e.msg="验证码错误"==e.msg?"短信验证码错误":e.msg,n.msg("提示:"+e.msg)))})}}),i.keydown(function(i){e.isAgree&&13==i.keyCode&&s.trigger("click")}),o},s}),define("user",["dialog","module/user/login","module/user/register","module/user/user.info","services/util"],function(e,i,t,n,s){function o(){this.login=new i,this.register=new t}o.prototype._login=function(){var e=this;$("#jLogin").on("click",function(){e.login.open(),e._afterOpenLogin(),s.gaSend("pc官网-点击登录","登录界面","")})},o.prototype.openLogin=function(){var e=this;e.login.open(),e._afterOpenLogin()},o.prototype._afterOpenLogin=function(){var e=this;$("#jR_L_Register").unbind().on("click",function(){e.login.close(),e.register.open(),e._afterRegisterOpen(),s.gaSend("pc官网-点击注册","注册界面","")})},o.prototype._register=function(){var e=this;$("#jRegister").on("click",function(){e.register.open(),e._afterRegisterOpen(),s.gaSend("pc官网-点击注册","注册界面",""),console.log("注册注册")})},o.prototype._afterRegisterOpen=function(){var e=this;$("#jR_R_Login").unbind().on("click",function(){e.register.close(),e.login.open(),e._afterOpenLogin(),s.gaSend("pc官网-点击登录","登录界面","")})},window.JIE=window.JIE||{},JIE.openLoginDialog=function(){(new o).openLogin()},$(function(){$.validator.methods.iphone=function(e,i){return this.optional(i)||/^1\d{10}$/.test(e)};var e=new o;e._login(),e._register(),new n})}),require.config({baseUrl:"/static/js/",urlArgs:"ver=1.5",paths:{dialog:"http://wimg.spriteapp.cn/pc/dialog/dialog",user:"module/user"},shim:{dialog:{exports:"dialog"}}}),require(["module/user/user.publish","user"],function(e){$(function(){new e})}),define("config/user/publish.config",function(){});