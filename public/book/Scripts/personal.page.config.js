/*!
 *
 * @version 1.2.0
 * @desc 不得姐PC 站 js
 * @author xierenhong 
 * @update date 更新时间：2018-02-08 09:15:11 *
 *   * -.-.  .
 * 有注释 只是为了 看看 cdn 是否刷新 然并卵
 *
 */

define("services/util",[],function(){return{params:function(e){var n,i,t,s,o,a,r,d="";for(n in e)if((i=e[n])instanceof Array)for(r=0;r<i.length;++r)o=i[r],t=n+"["+r+"]",a={},a[t]=o,d+=param(a)+"&";else if(i instanceof Object)for(s in i)o=i[s],t=n+"["+s+"]",a={},a[t]=o,d+=param(a)+"&";else void 0!==i&&null!==i&&(d+=encodeURIComponent(n)+"="+encodeURIComponent(i)+"&");return d.length?d.substr(0,d.length-1):d},GA:function(e,n){this.gaSend(e,n,"click")},gaSend:function(e,n,i){ga("send","event",e,n,i)},gaTemp:function(e,n,i,t){return _.template("<%= data.date %>|<%= data.time %>|<%= data.title %>|<%= data.id %>",{variable:"data"})({date:e||"无",time:n||"无",title:i||"无",id:t||"无"})},gaType:function(e,n){return _.template("<%= data.type %>|<%= data.video_mlen %>",{variable:"data"})({type:e,video_mlen:n})},getCookie:function(e){for(var n=document.cookie.split("; "),i=0;i<n.length;i++){var t=n[i].split("=");if(t[0]==e)return unescape(t[1])}return""},delCoolie:function(e){var n=new Date;n.setTime(n.getTime()-1);var i=this.getCookie(e);document.cookie=e+"="+i+"/domain=.budejie.com;path=/;expires="+n.toGMTString()},isWin:function(){return"Win32"==navigator.platform||"Windows"==navigator.platform},isPad:function(){return navigator.userAgent.match(/ipad/gi)},isWinClient:function(){if(this.isWin()){if(/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(navigator.userAgent)){if("NT"!=RegExp.$1)return!1;switch(RegExp.$2){case"6.3":return!0;case"10.0":return console.log("win 10"),!0;default:return!1}}return!1}return!1}}}),define("services/ajax",["services/util"],function(e){return{url:"http://api.budejie.com/api/api_open.php",$post:function(e,n,i){return this.$ajax(this.getConfig(e,n,i,"POST"))},$get:function(e,n,i){return this.$ajax(this.getConfig(e,n,i,"GET"))},$jsonp:function(e,n,i){var t={data:this.getParams(e)+"&callback=?",dataType:"JSONP",url:n};return this.$ajax(_.isObject(i)&&"[object File]"!==String(i)?$.extend({},t,i):t)},getParams:function(n){return _.isObject(n)&&"[object File]"!==String(n)?e.params(n):n},getConfig:function(e,n,i,t){var s=_.isUndefined(n)||n.length<=0?{data:this.getParams(e)+"&callback=?",dataType:"JSONP",xhrFields:{withCredentials:!0}}:{data:this.getParams(e),url:n,type:t};return _.isObject(i)&&"[object File]"!==String(i)?$.extend({},s,i):s},$ajax:function(e){var n=$.Deferred();return $.ajax($.extend({},{type:"GET",url:this.url,dataType:"json"},e)).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},$ajaxNew:function(e){var n=$.Deferred();return $.ajax($.extend({},{url:"http://d.api.budejie.com/tag/recommend/topic/"+e+"/budejie-android-6.8.0.json",dataType:"jsonp"})).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()}}}),define("services/user/user.service",["services/ajax"],function(e){return{serviceStatic:"http://d.api.budejie.com",login:function(n,i){return e.$jsonp({phonenum:n,password:md5(i)},this.serviceStatic+"/user/login")},register:function(n,i,t){return e.$jsonp({username:n,password:md5(i),verify_code:t},this.serviceStatic+"/user/register")},restPwd:function(n,i){return e.$jsonp({password:md5(n),re_password:md5(i)},this.serviceStatic+"/user/reset_password")},findPwd:function(n,i,t){return e.$jsonp({username:n,password:md5(i),verify_code:t},this.serviceStatic+"/user/register")},sendCode:function(n,i,t){return e.$jsonp({phonenum:n,verifytype:i,code:t},this.serviceStatic+"/user/getverifycode")},checkVerify:function(n,i){return e.$jsonp({phonenum:n,verify_code:i,verifytype:"reset_password"},this.serviceStatic+"/user/checkverify")},loginOut:function(){return e.$jsonp({client:"pc"},this.serviceStatic+"/user/logout")},getInfo:function(){return e.$jsonp({},this.serviceStatic+"/user/profile")},getUserInfoById:function(n){return e.$jsonp({a:"profile",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},getFansList:function(n,i){return e.$jsonp({a:"fans_list",c:"user",follow_id:i,userid:n},"http://api.budejie.com/api/api_open.php")},getFollowList:function(n,i){return e.$jsonp({a:"follow_list",c:"user",follow_id:i,userid:n},"http://api.budejie.com/api/api_open.php")},follow:function(n){return e.$jsonp({a:"follow",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},unFollow:function(n){return e.$jsonp({a:"unfollow",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},getNewsList:function(n,i,t,s){return e.$jsonp({a:"msgcenter",c:"msg",appname:"baisishequ",from:"www",page:i,per:t,uid:n,max:s,ver:"4.0",client:"ios"},"http://api.budejie.com/api/api_open.php")}}}),define("services/topic",["services/ajax"],function(e){return{serviceStatic:"http://d.api.budejie.com",getTags:function(n){return e.$ajaxNew(n)},getMyTopic:function(n,i){return e.$jsonp({},this.serviceStatic+"/topic/my-topic/baisishequ-iphone-3.9.1/"+n+"-"+i+".json")},getMyShareTopic:function(n,i,t){return e.$jsonp({},this.serviceStatic+"/topic/share-topic/"+n+"/baisishequ-iphone-8.0/"+i+"-"+t+".json")},getMyCommentTopic:function(n,i,t){return e.$jsonp({},this.serviceStatic+"/comment/user-comment/"+n+"/baisishequ-iphone-8.0/"+i+"-"+t+".json")},delTopic:function(n){return e.$jsonp({},"http://api.budejie.com/api/api_open.php?c=topic&a=deltopic&tid="+n)},delComment:function(n){return e.$jsonp({a:"delete",c:"comment",formart:"json",cid:n,uid:"14397564"},"http://api.budejie.com/api/api_open.php")},getUserTopic:function(n,i,t){return e.$jsonp({},this.serviceStatic+"/topic/user-topic/"+n+"/1/desc/baisishequ-win-1.0/"+i+"-"+t+".json")},sendContent:function(n,i){return e.$jsonp({theme_name:i},"http://api.budejie.com/api/api_open.php?c=topic&a=createugc&type=29&format=json&content="+n)},sendLink:function(n){return e.$jsonp(n,this.serviceStatic+"/topic/push_url_topic")}}}),define("services/player",["jwplayer","services/util","store","slide"],function(e,n,i){var t=function(e,n,i,t,s){this.width=566,this.height=360,this.type=t,this.poster=i,this.mediaSrc=n,this.id=e,this.pid=s,this.playerInstance=null,!_.isUndefined(this.id)&&this.id.length>0&&this.init()};return t.prototype={init:function(){var t=this,s="audio"===this.type?"skin/five-audio.xml":"skin/five-video.xml";this.playerInstance=e(this.id),this.playerInstance.setup({flashplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer.flash.swf",file:this.mediaSrc,image:this.poster,skin:"http://wimg.spriteapp.cn/pc/jwplayer/"+s,width:this.width,height:this.height,events:{onComplete:function(){t.ended();var e=$("#"+t.id).parents(".j-video-c"),s=e.data("id");i.get("w3_ga_play_ended_"+s)||(n.gaSend("视频播放行为统计-按浏览器去重","视频播放结束",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),s)+"|"+e.data("videomlen")),i.set("w3_ga_play_ended_"+s,s)),n.gaSend("pc官网-推荐内容显示","视频播放完成后显示更多视频",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),s)+"|"+e.data("videomlen"))},onVolume:function(){},onReady:function(){t.ready()},onPlay:function(){t.play();var e=$("#"+t.id).parents(".j-video-c"),s=e.data("id");i.get("w3_ga_play_playing_"+s)||(n.gaSend("视频播放行为统计-按浏览器去重","点击播放按钮",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),s)+"|"+e.data("videomlen")),i.set("w3_ga_play_playing_"+s,s))},onPause:function(){},onBufferChange:function(){},onBufferFull:function(){},onError:function(e){console.log(e.message);var i=$("#"+t.id).parents(".j-video-c");n.gaSend("视频播放错误",e.message,n.gaTemp(i.data("date"),i.data("time"),i.data("title"),i.data("id"))+"|"+i.data("videomlen"))},onFullscreen:function(e){e.fullscreen},onMute:function(e){}}})},play:function(){var n=$(".j-video-c"),i=n.find(".jwplayer"),t=this;$.each(i,function(){var n=$(this).attr("id");t.id!=n&&e(n).stop()})},ended:function(){if("video"===this.type){var n=$("#"+this.id).parents(".j-video-c").find(".j-v-d-c"),i=this;n.length>0&&(e("jDownloadVideo").play(),n.show(),n.find(".icon-replay").on("click",function(){n.hide(),e(i.id).play()}))}},ready:function(){if("video"===this.type){var e=$("#j-v-container-"+this.pid);if(e.length>0){e.find(".tempWrap").length<=0&&e.find(".slideBox").slide({mainCell:".bd > ul",effect:"leftLoop",autoPlay:!1,trigger:"click",easing:"swing",delayTime:1e3,slideW:566,mouseOverStop:!0,pnLoop:!1})}}}},{init:function(e,n,i,s,o){return new t(e,n,i,s,o)},setup:function(){$("#jDownloadVideo").length<=0||e("jDownloadVideo").setup({flashplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer.flash.swf",file:"http://wvoice.spriteapp.cn/voice1/download.mp3",image:"http://mpic.spriteapp.cn/crop/152x93/picture/2015/0624/558a9dce3541d.jpg",skin:"http://wimg.spriteapp.cn/pc/jwplayer/skin/five-audio.xml",width:0,height:0,controls:!1})}}}),define("services/toolbar",["services/ajax","store"],function(e,n){return{love:function(i,t){if(!n.get("u_ding_cai_"+t)&&!$(i).hasClass("active")&&!$(i).hasClass("active")){var s=$(i).children("span").text().trim();s=Number(s)+1,$(i).addClass("active"),$(i).next("span").addClass("tlargen");var o=$('<div class="ding">+1</div>');o.appendTo($(i)),setTimeout(function(){$(o).remove()},500),$(i).children("span").text(s),n.set("u_ding_cai_"+t,t),e.$get({c:"post",a:"love",cid:t}).then(function(e){console.log(e)})}},nolove:function(i,t){if(!n.get("u_ding_cai_"+t)&&!$(i).hasClass("active")&&!$(i).hasClass("active")){var s=$(i).children("span").text().trim();s=Number(s)+1,$(i).addClass("active"),$(i).next("span").addClass("tlargen"),$(i).children("span").text(s),n.set("u_ding_cai_"+t,t),e.$get({c:"post",a:"cai",id:t}).then(function(e){console.log(e)})}},collect:function(e,i){n.get("u_collect_"+i)||$(e).parent().hasClass("active")||($(e).parent().addClass("active"),n.set("u_collect_"+i,i))},getPid:function(){return $(this).parents(".j-r-list-tool-l").data("id")}}}),define("services/message",["dialog"],function(e){return{alert:function(n){e({title:"操作提示",content:n}).show()},msg:function(n,i){var t=i||2e3,s=e({skin:"j-msg",title:"操作提示",content:n});s.show(),setTimeout(function(){s.close().remove()},t)}}}),define("services/dialog",["dialog","services/util"],function(e,n){return{iSiPad:function(){return navigator.userAgent.match(/ipad/gi)},iSwIn10:function(){return navigator.userAgent.match(/Windows NT 10.0/i)},isMac:function(){return/macintosh|mac os x/i.test(navigator.userAgent)},openDialogQr:function(){var i;i=this.iSiPad()?{innerHTML:this.getIpadTemp(),height:190,width:430}:n.isWinClient()?{innerHTML:this.getWin10Temp(),height:190,width:430}:this.isMac()>0?{innerHTML:this.getMacTemp(),height:190,width:430}:{content:this.getPcTemp(),height:330,width:312,title:"更多功能请下载好书荐读客户端"};var t=new e(i);t.showModal(),$(".iPad-dialog-header").on("click",function(){t.close()}),this.iSiPad()&&$("div.iPad-dialog i.icon-hd-download").on("click",function(){window.location.href="http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_hd&utm_medium=tanceng&utm_campaign=hd"}),n.isWinClient()&&$("div.win10-dialog i.icon-win10-download").on("click",function(){window.open("http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_win&utm_medium=tanceng&utm_campaign=win")}),this.isMac()&&$("div.mac-dialog i.icon-mac-download").on("click",function(){window.open("http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_mac&utm_medium=tanceng&utm_campaign=mac")}),$(".ui-popup-backdrop").on("click",function(){t.close()})},getPcTemp:function(){return'<div class="d-c default" style="width: 310px; ">\n    <div class="d-c-qr">\n        <i class="icon-d-qr"></i>\n    </div>\n    <div class="d-c-txt">扫二维码&nbsp;&nbsp;用手机看百思</div>\n</div>'},getIpadTemp:function(){return'<div class="iPad-dialog" i="dialog">\n<div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download" ></i></div></div>'},getWin10Temp:function(){return'<div class="iPad-dialog win10-dialog" i="dialog"><div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download icon-win10-download" ></i></div></div>'},getMacTemp:function(){return'<div class="iPad-dialog mac-dialog" i="dialog"><div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download icon-mac-download" ></i></div></div>'},openDiffDialogQr:function(n,i,t){var s=e({title:n,content:this.getPcDiffTemp(i,t),height:330,width:312});s.showModal(),$(".ui-popup-backdrop").on("click",function(){s.close()})},getPcDiffTemp:function(e,n){return'<div class="d-c default" style="width: 310px; ">\n    <div class="d-c-qr">\n        <i class="icon-d-qr '+e+'"></i>\n    </div>\n    <div class="d-c-txt">'+n+"</div>\n</div>"},openVideoDialog:function(){}}}),define("module/user/personal.page",["services/user/user.service","services/topic","services/player","services/toolbar","services/message","scrollPagination","services/dialog"],function(e,n,i,t,s,o,a){function r(){this.np=0,this.page=20,this.uid=null,this.isLoad=!1,this.npIng=null,this.timeOut=null,this.$tempHtml=$("#tempTopic").html(),this.$loading=$("#scrollPageLoading"),this.loaded=!1,this._init()}return $("img.lazy").lazyload({effect:"fadeIn",event:"scrollstop",threshold:20,container:$(".g-sd")}),$.fn.fadeInWithDelay=function(){var e=0;return this.each(function(){$(this).delay(e).animate({opacity:1},200),e+=100})},r.prototype._init=function(){!_.isUndefined(JIE.userId)&&JIE.userId.length>0?this._topicInit():this._userInfo()},r.prototype._userInfo=function(){var n=this;e.getInfo().then(function(e){e&&e.data&&(n.uid=e.data.id,n._topicInit())})},r.prototype._topicInit=function(){var e=this,i=$("#topicList");i.scrollPagination({scrollTarget:$(window),heightOffset:1200,beforeLoad:function(){e.$loading.fadeIn()},afterLoad:function(n){$(n).fadeInWithDelay(),e.$loading.hide(),e.isLoad=!1,$("div.lazy,img.lazy").lazyload({effect:"fadeIn",event:"scrollstop",threshold:20})},loadContent:function(t){if(e.isLoad||e.npIng==e.np||e.loaded)return!1;e.isLoad=!0;var s=null,o=null;o=_.isUndefined(JIE.userId)?e.uid:JIE.userId,"publish"==JIE.topicType?s=!_.isUndefined(JIE.userId)&&JIE.userId.length>0?n.getUserTopic(o,e.np,e.page):n.getMyTopic(e.np,e.page):"share"==JIE.topicType?s=n.getMyShareTopic(o,e.np,e.page):"comment"==JIE.topicType&&(s=n.getMyCommentTopic(o,e.np,e.page)),s.then(function(n){var s=n.list,o=n.info;if(null===n||null==s)return e.loaded=!0,i.stopScrollPagination(),$("#commentNoMoreMsg").show(),!1;if(s.length<=0||0==o.count)return e.loaded=!0,i.stopScrollPagination(),$("#commentNoMoreMsg").show(),!1;var a=_.filter(s,function(e){return _.isUndefined(e.content)||e.content.length>0}),r=_.template(e.$tempHtml,{variable:"topic"}),d=r(_.map(a,function(e){var n=e.topic,i=e.repost,t=e;return!_.isUndefined(n)&&_.isObject(n)?t=_.extend({},n,{my_comment:_.extend({},e,{topic:null})}):!_.isUndefined(i)&&_.isObject(i)&&(t=_.extend({},i,{my_repost:_.extend({},e,{repost:null,status_text:null}),status_text:e.status_text})),t}));if($(d).appendTo(i),null==o.np)return e.loaded=!0,i.stopScrollPagination(),$("#commentNoMoreMsg").show(),!1;if(e.np=n.info.np,null!=t.afterLoad){var c=i.children("[rel!=loaded]");t.afterLoad.call(i,c)}e._event(),e._delTopic(),e._delComment()},function(e){i.stopScrollPagination(),i.fadeOut()})}})},r.prototype._event=function(){$.each($(".j-video"),function(){var e=$(this);i.init(e.attr("id"),e.data("mp4"),e.data("poster"),"video",e.data("id"))}),$.each($(".j-audio"),function(){var e=$(this);i.init(e.attr("id"),e.data("mp3"),e.data("poster"),"audio",e.data("id"))}),$(".j-r-list-tool-l-up").unbind().on("click",function(){t.love(this,t.getPid.call(this))}),$(".j-r-list-tool-l-down ").unbind().on("click",function(){t.nolove(this,t.getPid.call(this))}),$(".icon-comment").unbind().on("click",function(){$(this).parent().hasClass("active")||$(this).parent().addClass("active")}),$(".icon-cc").unbind().on("click",function(){a.openDialogQr()})},r.prototype._delTopic=function(){$(".j-r-list-tool-del").unbind().on("click",function(){var e=$(this).parents(".j-r-list-tool").data("id");n.delTopic(e).then(function(e){"0"==e.result?window.location.reload():s.msg("删除失败")})})},r.prototype._delComment=function(){$(".icon-del.f-fr").unbind().on("click",function(){var e=$(this).parents(".p-master-comment").data("id");n.delComment(e).then(function(e){"0"==e?window.location.reload():s.msg("删除失败")})})},r}),define("module/user/validate",[],function(){return{common:function(){return{errorPlacement:function(e,n){n.parents(".j-u-c-input").addClass("j-v-error").after(e)},success:function(e){var n=e.prev();n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}}}}}),define("module/user/user.info",["services/user/user.service","services/message","dialog","services/util"],function(e,n,i,t){function s(){this.getInfo(),this.$loginBar=$("#jLoginBar"),this.$jUserLoginBar=$("#jUserLoginBar"),this.$userInfo=$("#userInfo"),this.$userFollow=$("#userFollow"),this.$userFans=$("#userFans"),this.$userNewsIcon=$("#userNewsIcon"),this.$userNewsHtml="",this.$jTitle=$("#jTitle"),this.location=window.location}function o(e){var n=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==n||n.length<1?null:n[1]}return s.prototype.getInfo=function(){var n=e.getUserInfoById(),i=this;n.then(function(e){if(e&&(i._rightUserInfo(e),i._rightUserFollow(e),i._rightUserFans(e),i._topUserNews(e),i.auth(e),0==e.code)){var n=_.escape(e.data.username);i.bind(n.length>9?n.substring(0,8)+"...":n,n)}})},s.prototype._len=function(e){return e.replace(/[^\x00-\xff]/g,"**").length},s.prototype.bind=function(e,n){console.log(e),this.$loginBar.hide(),this.$jUserLoginBar.find("#jUserLoginName").text(e).attr("title",n),this.$jUserLoginBar.show(),this._event()},s.prototype._event=function(){var t=$("#jLoginExit"),s=this;t.length>0&&t.on("click",function(){e.loginOut().then(function(e){e&&0==e.result&&(n.msg(e.result_desc),s.$loginBar.show(),s.$jUserLoginBar.hide(),s.location.reload())})}),s.$userNewsIcon.length>0&&s.$userNewsIcon.on("click",function(){i({padding:0,quickClose:!0,content:s.$userNewsHtml}).show(document.getElementById("userNewsIcon"))})},s.prototype.auth=function(e){var n=this;if(0!=e.code&&"True"==jie.is_oauth_login&&(n.location.href="/user/login?r_url="+encodeURI(n.location.href)),0==e.code&&"True"==jie.is_login_page){var i=o("r_url");n.location.href=null!=i?i:"http://www.budejie.com"}},s.prototype._rightUserInfo=function(n){var i=this;if(i.$userInfo.length>0)if(window.JIE=window.JIE||{},!_.isUndefined(JIE.userId)&&JIE.userId.length>0)e.getUserInfoById(JIE.userId).then(function(e){if(e){e.data.username=_.escape(e.data.username),e.data.introduction=_.escape(e.data.introduction);var n=_.template(i._rightOtherUserInfoTemp(),{variable:"user"}),t=n(e.data);i.$userInfo.html(t),i._followEvent(),i._updateTitle(e.data.username)}});else if(0==n.code){n.data.username=_.escape(n.data.username),n.data.introduction=_.escape(n.data.introduction);var t=_.template(i._rightUserInfoTemp(),{variable:"user"}),s=t(n.data);i.$userInfo.html(s),i._updateTitle(n.data.username)}},s.prototype._rightUserFollow=function(n){var i=this;if(i.$userFollow.length>0){window.JIE=window.JIE||{};var t=0,s=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(t=JIE.userId,s=!0):(t=n.id,s=!1);e.getFollowList(t,0).then(function(e){if(e&&0==e.code){var n=e.data;n.list=$(n.list).slice(0,5);for(var t=0;t<n.list.length;t++)n.list[t].username=_.escape(n.list[t].username),n.list[t].username.length>3&&(n.list[t].username=n.list[t].username.substring(0,2)+"...");n.isOthers=s;var o=_.template(i._rightUserFollowTemp(),{variable:"follow"}),a=o(n);i.$userFollow.html(a)}})}},s.prototype._rightUserFans=function(n){var i=this;if(i.$userFans.length>0){window.JIE=window.JIE||{};var t=0,s=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(t=JIE.userId,s=!0):(t=n.id,s=!1);e.getFansList(t,0).then(function(e){if(e&&0==e.code){var n=e.data;n.list=$(n.list).slice(0,5);for(var t=0;t<n.list.length;t++)n.list[t].username=_.escape(n.list[t].username),n.list[t].username.length>3&&(n.list[t].username=n.list[t].username.substring(0,2)+"...");n.isOthers=s;var o=_.template(i._rightUserFansTemp(),{variable:"fans"}),a=o(n);i.$userFans.html(a)}})}},s.prototype._topUserNews=function(n){var i=this;if(i.$userNewsIcon.length>0){e.getNewsList(n.data.id,1,5,0).then(function(e){if(e){var n=_.template(i._topUserNewsTemp(),{variable:"news"}),t=n(_.map(e.list,function(e){var n={};return n.ctime=e.ctime,"url_topic"==e.type||"system"==e.type?n.title="系统消息:"+_.escape(e.body):n.title=_.escape(e.title),n.title.length>14&&(n.title=_.escape(n.title.substring(0,14))+"..."),e.pinfo&&(n.id=e.pinfo.id),n}));i.$userNewsHtml=t}})}},s.prototype._followEvent=function(){var i=this;i.$userInfo.find(".j-follow").on("click",function(){var s=$(this),o=s.data("userid");t.gaSend("pc官网-关注好友","点击关注button",""),i._isLogin(function(){e.follow(o).then(function(e){console.log(e),s.hide(),s.next().show(),n.msg(e.msg)})})}),i.$userInfo.find(".j-un-follow").on("click",function(){var s=$(this),o=s.data("userid");t.gaSend("pc官网-取消关注好友","点击取消关注button",""),i._isLogin(function(){e.unFollow(o).then(function(e){console.log(e),s.hide(),s.prev().show(),n.msg(e.msg)})})})},s.prototype._rightUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/topic/" title="<%= user[\'username\'] %>" class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},s.prototype._rightOtherUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/others-<%= user[\'id\'] %>.html"  title="<%= user[\'username\'] %>"  class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n        <%if (user.relationship == \'0\' || user.relationship == \'3\' ) { %>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow">+ 关注</a>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow" style="display: none;">取消关注</a>\n        <% } %>\n        <%if (user.relationship == \'2\' || user.relationship == \'4\') { %>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow"  style="display: none;">+ 关注</a>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow">取消关注</a>\n        <% } %>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},s.prototype._rightUserFollowTemp=function(){return'<div class="p-age-attente-title"><span>关注（<%= follow[\'info\'][\'count\']%>人）</span><a href="/user/follow/<%= follow.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(follow[\'list\']) > 0) { _.each(follow[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有关注人哦</li><% } %></ul>'},s.prototype._rightUserFansTemp=function(){return'<div class="p-age-attente-title"><span>粉丝（<%= fans[\'info\'][\'count\']%>人）</span><a href="/user/fans/<%= fans.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(fans[\'list\']) > 0) { _.each(fans[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有粉丝哦</li><% } %></ul>'},s.prototype._topUserNewsTemp=function(){return"<div class=\"j-new-box\"><ul><% if (_.size(news) > 0) { _.each(news, function(item) { %><li><a href=\"<%= item['id'] == undefined ? '/user/news' : '/detail-' + item['id'] + '.html' %>\"><%= item['title']%></a></li><% });} else { %><li class=\"j-new-none-msg\">没有消息提醒</li><% } %><li class=\"j-new-more\"><a href=\"/user/news\">查看更多</a></li></ul></div>"},s.prototype._isLogin=function(n){e.getInfo().then(function(e){1==e.code?(window.JIE=window.JIE||{},JIE.openLoginDialog()):n&&n.call()})},s.prototype._updateTitle=function(e){this.$jTitle.length>0&&(window.JIE=window.JIE||{},JIE.isUpdateTitle&&this.$jTitle.text(this.$jTitle.text().replace("@userName@",e)))},s}),define("module/user/findpwd",["dialog","services/ajax","module/user/validate","services/user/user.service","services/message","module/user/user.info"],function(e,n,i,t,s,o){function a(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return a.prototype.open=function(){var n=this,i=e.get("j-find");if(!_.isUndefined(i))return void i.showModal();n.dlg=new e({id:"j-find",fixed:!0,innerHTML:this.temp(),height:340,width:594}),n.dlg.showModal(),n.event();var t=n.validate();n.sendCode(t),$("input, textarea").placeholder()},a.prototype.opens=function(){var n=this,i=e.get("j-finds");if(!_.isUndefined(i))return void i.showModal();this.dlg=new e({id:"j-finds",fixed:!0,innerHTML:this.temps(),height:340,width:594}),n.dlg.showModal(),$("#jFindDCles").on("click",function(){n.dlg.close()}),n.validates(),$("input, textarea").placeholder()},a.prototype.temp=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFind">\n                <div class="j-u-d-c-one  j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span>+86 <input type="text" placeholder="请输入手机号" name="username" class="j-u-d-c-p-con j-findpwd-telephone" id="findTxtUserName">\n                    </div>\n                    </div>\n                <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符"  name="vcode" class="j-u-d-c-p-con" id="txtFindVCode">\n                    </div><div id="jFindVCode" class="j-u-d-c-vcode"><img id="jFindVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div>\n                </div><div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"  name="code" class="j-u-d-c-p-con" id="findCode">\n                    </div>\n                <div class="j-u-d-c-code" id="jGetCode">获取验证码</div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindSubmit" class="j-u-d-submit j-code-submit">提交</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.temps=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCles"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFinds">\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password" placeholder="请输入密码" class="j-u-d-c-p-con" name="password" id="password">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">确认密码 |  </span><input type="password" placeholder="请再次输入密码确认" class="j-u-d-c-p-con" name="apassword" id="apassword">\n                    </div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindsSubmit" class="j-u-d-submit">确定</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.event=function(){var e=this;$("#jFindDCle").on("click",function(){e.dlg.close()})},a.prototype.sendCode=function(e){var n=this,i=$("#jFindVCodeImg");i.attr("src",n.vCodeUrl+"?t="+(new Date).getTime()),$("#jFindVCode").on("click",function(){i.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())}),$("#jGetCode").on("click",function(){var o=$.trim($("#findTxtUserName").val()),a=$.trim($("#txtFindVCode").val());if(o.length<=0||!/^1\d{10}$/.test(o))return void e.element("#findTxtUserName");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtFindVCode");if(!(n.seconds>0&&n.seconds<60||n.codeIsSend)){t.sendCode(o,"reset_password",a).then(function(e){e&&(0==e.code?(s.msg("验证码发送成功！"),n.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,s.msg("提示:"+e.msg),i.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())))})}})},a.prototype.disabledSendBtn=function(){var e=$("#jGetCode"),n=this,i=setInterval(function(){n.seconds--,e.text(n.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==n.seconds&&(clearInterval(i),n.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),n.codeIsSend=!1)},1e3)},a.prototype.validate=function(){var e=this,n=$("#ffFind"),i=n.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,n){n.parents(".j-u-d-f-input").addClass("j-v-error").parents(".j-u-d-c-code").after(e)},success:function(e){var n=e.prev().find(".j-u-d-f-input");n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}});return $("#btnFindSubmit").on("click",function(){if(n.valid()){var o=$("#findTxtUserName"),a=$("#findCode");i.resetForm();t.checkVerify(o.val(),a.val()).then(function(n){n&&(1e3==n.code?(e.dlg.close(),e.opens()):(n.msg="验证码错误"==n.msg?"短信验证码错误":n.msg,s.msg("提示:"+n.msg)))},function(){s.msg("网络超时,请稍后重试！")})}}),n.keydown(function(e){13==e.keyCode&&$("#btnFindSubmit").trigger("click")}),i},a.prototype.validates=function(){var e=$("#ffFinds"),n=e.validate($.extend({},i.common(),{rules:{password:{required:!0,minlength:6,maxlength:16},apassword:{required:!0,equalTo:"#password"}},messages:{password:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"},apassword:{required:"密码不能为空",equalTo:"两次输入的密码不一致,请重新输入"}}}));return $("#btnFindsSubmit").on("click",function(){if(e.valid()){var i=$("#password"),o=$("#apassword");n.resetForm();t.restPwd(i.val(),o.val()).then(function(e){
e&&(1e3==e.code?(s.msg("修改密码成功"),window.location.reload()):s.msg(e.msg))},function(){s.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&$("#btnFindsSubmit").trigger("click")}),n},a}),define("module/user/login",["dialog","module/user/findpwd","services/util","module/user/validate","module/user/user.info","services/user/user.service","services/message"],function(e,n,i,t,s,o,a){function r(){this.dlg=null}return r.prototype.open=function(){var n=this,i=e.get("j-Login");return _.isUndefined(i)?(n.dlg=new e({id:"j-Login",fixed:!0,innerHTML:this.temp(),height:393,width:740}),n.dlg.showModal(),n.event(),$("input.j-u-d-c-p-con").placeholder(),n.remindMe(),n.findPwd(),void n.validate()):void i.showModal()},r.prototype.close=function(){this.dlg.close()},r.prototype.temp=function(){return'<div class="j-ui-dialog j-regist j-login" >\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">登录</div>\n        <span class="j-u-d-h-close" id="jLoginDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffLogin">\n                <div class="j-u-d-c-one j-u-d-c-spe">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                            <span class="j-u-d-c-p-tit">账&nbsp;&nbsp;&nbsp;&nbsp;号 |  </span>\n                            <input id="txtUserName" name="username" type="text" placeholder="手机号" class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input id="txtUserPwd" name="userpwd" type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me" id="jRemindMe">\n                        <span class="icon-checkbox "></span>\n                        &nbsp;&nbsp;姐，记住我\n                    </label>\n                    <a class="forget-password" id="jForgetPwd">忘记密码</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit j-u-d-login">登录</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-regist-des">还没有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_L_Register">注册</span>\n            </div>\n        </div>\n    </div>\n</div>'},r.prototype.event=function(){var e=this;$("#jLoginDCle").on("click",function(){e.dlg.close()})},r.prototype.remindMe=function(){var e=$("#jRemindMe"),n=e.find("span.icon-checkbox"),i=$.cookie("bdj_username"),t=$("#txtUserName"),s=$("#txtUserPwd");void 0!=i&&(!n.hasClass("icon-checkbox-click")&&n.addClass("icon-checkbox-click"),t.val(i),s.val($.cookie("bdj_user_pwd"))),e.on("click",function(){n.hasClass("icon-checkbox-click")?(n.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"})):(n.addClass("icon-checkbox-click"),$.cookie("bdj_username",t.val(),{path:"/"}),$.cookie("bdj_user_pwd",s.val(),{path:"/"}))}),t.keyup(function(){!/^1\d{10}$/.test($(this).val())&&n.hasClass("icon-checkbox-click")&&(n.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"}))})},r.prototype.findPwd=function(){var e=this;$("#jForgetPwd").on("click",function(){e.dlg.close(),(new n).open(),i.gaSend("pc官网-点击忘记密码","忘记密码","")})},r.prototype.validate=function(){var e=$("#ffLogin"),n=$(".j-u-d-login"),s=e.validate($.extend({},t.common(),{rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:6,maxlength:16}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"}}}));n.on("click",function(){if(e.valid()){var n=$("#txtUserName"),t=$("#txtUserPwd");s.resetForm();o.login(n.val(),t.val()).then(function(e){e&&(1e3==e.code?(a.msg("登录成功"),i.gaSend("pc官网-点击登录","登录成功",""),window.location.reload()):a.msg(e.msg))},function(){a.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&n.trigger("click")})},r}),define("module/user/register",["dialog","module/user/user.info","services/user/user.service","services/message"],function(e,n,i,t){function s(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.isAgree=!0,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return s.prototype.open=function(){var n=this,i=e.get("j-register");if(!_.isUndefined(i))return void i.showModal();n.dlg=new e({id:"j-register",fixed:!0,innerHTML:this.temp(),height:454,width:772}),n.dlg.showModal(),n.event();var t=n.validate();n.sendCode(t)},s.prototype.close=function(){this.dlg.close()},s.prototype.temp=function(){return'<div class="j-ui-dialog j-regist">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">注册 我要做姐粉</div>\n        <span class="j-u-d-h-close" id="jRegisterDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffRegister">\n                <div class="j-u-d-c-one j-u-d-c-spe j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span><input type="text" placeholder="请输入手机号"\n                                                                         class="j-u-d-c-p-con" name="username" id="txtUserRegistTelephone">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con" name="userpwd"  id="txtUserRegistPwd" >\n                    </div>\n                </div>\n       <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register"><div class="j-u-d-c-phone j-u-d-fl j-u-c-input"><span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符" class="j-u-d-c-p-con" name="vcode" id="txtRegVCode"></div><div id="jRegVCode" class="j-u-d-c-vcode"><img id="jRegVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div></div>\n         <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-d-fl j-u-c-input">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"\n                                                                         class="j-u-d-c-p-con"  name="code" id="txtUserRegistCode">\n                    </div>\n                    <div class="j-u-d-c-code" id="jRegistGetCode">获取验证码</div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me">\n                        <span class="icon-checkbox icon-checkbox-click"></span>\n                        &nbsp;&nbsp;签署姐的\n                    </label><a href="http://www.budejie.com/budejie/privacy.html" target="_block" class="j-u-d-privacy">注册协议</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit" id="btnRegister">注册</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-login-des">已有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_R_Login">登录</span>\n            </div>\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n'},s.prototype.event=function(){var e=this;$("#jRegisterDCle").on("click",function(){e.dlg.close()}),$("input, textarea").placeholder();var n=$("#btnRegister");$(".remind-me").click(function(){$(this).find("span").hasClass("icon-checkbox-click")?($(this).find("span").removeClass("icon-checkbox-click"),e.isAgree=!1,n.addClass("j-u-d-submit-disabled")):($(this).find("span").addClass("icon-checkbox-click"),e.isAgree=!0,n.removeClass("j-u-d-submit-disabled"))})},s.prototype.sendCode=function(e){var n=this,s=$("#jRegVCodeImg");s.attr("src",n.vCodeUrl+"?t="+(new Date).getTime()),$("#jRegVCode").on("click",function(){s.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())}),$("#jRegistGetCode").on("click",function(){var o=$.trim($("#txtUserRegistTelephone").val()),a=$.trim($("#txtRegVCode").val());if(o.length<=0||!/^1\d{10}$/.test(o))return void e.element("#txtUserRegistTelephone");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtRegVCode");if(!(n.seconds>0&&n.seconds<60||n.codeIsSend)){i.sendCode(o,"register",a).then(function(e){e&&(0==e.code?(t.msg("验证码发送成功！"),n.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,t.msg("提示:"+e.msg),s.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())))})}})},s.prototype.disabledSendBtn=function(){var e=$("#jRegistGetCode"),n=this,i=setInterval(function(){n.seconds--,e.text(n.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==n.seconds&&(clearInterval(i),n.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),n.codeIsSend=!1)},1e3)},s.prototype.validate=function(){var e=this,n=$("#ffRegister"),s=$("#btnRegister"),o=n.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:8,maxlength:16},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持8-16位数字、字母和符号",maxlength:"密码仅支持8-16位数字、字母和符号"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,n){n.parents(".j-u-c-input").addClass("j-v-error").parents(".j-u-d-c-register").after(e)},success:function(e){var n=e.prev().find(".j-u-c-input");n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}});return s.on("click",function(){if(e.isAgree&&n.valid()){var s=$("#txtUserRegistTelephone"),a=$("#txtUserRegistPwd"),r=$("#txtUserRegistCode");o.resetForm();i.register(s.val(),a.val(),r.val()).then(function(e){console.log(e),e&&(1e3==e.code?(t.msg("注册成功"),ga("send","event","pc官网-点击注册","注册成功",""),window.location.reload()):(e.msg="验证码错误"==e.msg?"短信验证码错误":e.msg,t.msg("提示:"+e.msg)))})}}),n.keydown(function(n){e.isAgree&&13==n.keyCode&&s.trigger("click")}),o},s}),define("user",["dialog","module/user/login","module/user/register","module/user/user.info","services/util"],function(e,n,i,t,s){function o(){this.login=new n,this.register=new i}o.prototype._login=function(){var e=this;$("#jLogin").on("click",function(){e.login.open(),e._afterOpenLogin(),s.gaSend("pc官网-点击登录","登录界面","")})},o.prototype.openLogin=function(){var e=this;e.login.open(),e._afterOpenLogin()},o.prototype._afterOpenLogin=function(){var e=this;$("#jR_L_Register").unbind().on("click",function(){e.login.close(),e.register.open(),e._afterRegisterOpen(),s.gaSend("pc官网-点击注册","注册界面","")})},o.prototype._register=function(){var e=this;$("#jRegister").on("click",function(){e.register.open(),e._afterRegisterOpen(),s.gaSend("pc官网-点击注册","注册界面",""),console.log("注册注册")})},o.prototype._afterRegisterOpen=function(){var e=this;$("#jR_R_Login").unbind().on("click",function(){e.register.close(),e.login.open(),e._afterOpenLogin(),s.gaSend("pc官网-点击登录","登录界面","")})},window.JIE=window.JIE||{},JIE.openLoginDialog=function(){(new o).openLogin()},$(function(){$.validator.methods.iphone=function(e,n){return this.optional(n)||/^1\d{10}$/.test(e)};var e=new o;e._login(),e._register(),new t})}),require.config({baseUrl:"/static/js/",urlArgs:"ver=1.7",paths:{scrollUp:"http://wimg.spriteapp.cn/pc/common/jquery.scrollUp",scrollPagination:"http://wimg.spriteapp.cn/pc/common/scrollpagination",dialog:"http://wimg.spriteapp.cn/pc/dialog/dialog",jwplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer",store:"http://wimg.spriteapp.cn/pc/common/store",slide:"http://wimg.spriteapp.cn/pc/superslide/jquery.SuperSlide.2.1.1.source",user:"module/user"},shim:{scrollUp:{exports:""},dialog:{exports:"dialog"},jwplayer:{exports:"jwplayer"},slide:{exports:""}}}),require(["module/user/personal.page","user","scrollUp"],function(e){$(function(){new e,$.scrollUp({animation:"slide"})})}),define("config/user/personal.page.config",function(){});