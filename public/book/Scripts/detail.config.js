/*!
 *
 * @version 1.2.0
 * @desc 不得姐PC 站 js
 * @author xierenhong 
 * @update date 更新时间：2018-02-08 09:15:11 *
 *   * -.-.  .
 * 有注释 只是为了 看看 cdn 是否刷新 然并卵
 *
 */

define("services/util",[],function(){return{params:function(e){var n,t,i,o,s,a,d,r="";for(n in e)if((t=e[n])instanceof Array)for(d=0;d<t.length;++d)s=t[d],i=n+"["+d+"]",a={},a[i]=s,r+=param(a)+"&";else if(t instanceof Object)for(o in t)s=t[o],i=n+"["+o+"]",a={},a[i]=s,r+=param(a)+"&";else void 0!==t&&null!==t&&(r+=encodeURIComponent(n)+"="+encodeURIComponent(t)+"&");return r.length?r.substr(0,r.length-1):r},GA:function(e,n){this.gaSend(e,n,"click")},gaSend:function(e,n,t){ga("send","event",e,n,t)},gaTemp:function(e,n,t,i){return _.template("<%= data.date %>|<%= data.time %>|<%= data.title %>|<%= data.id %>",{variable:"data"})({date:e||"无",time:n||"无",title:t||"无",id:i||"无"})},gaType:function(e,n){return _.template("<%= data.type %>|<%= data.video_mlen %>",{variable:"data"})({type:e,video_mlen:n})},getCookie:function(e){for(var n=document.cookie.split("; "),t=0;t<n.length;t++){var i=n[t].split("=");if(i[0]==e)return unescape(i[1])}return""},delCoolie:function(e){var n=new Date;n.setTime(n.getTime()-1);var t=this.getCookie(e);document.cookie=e+"="+t+"/domain=.budejie.com;path=/;expires="+n.toGMTString()},isWin:function(){return"Win32"==navigator.platform||"Windows"==navigator.platform},isPad:function(){return navigator.userAgent.match(/ipad/gi)},isWinClient:function(){if(this.isWin()){if(/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(navigator.userAgent)){if("NT"!=RegExp.$1)return!1;switch(RegExp.$2){case"6.3":return!0;case"10.0":return console.log("win 10"),!0;default:return!1}}return!1}return!1}}}),define("services/dialog",["dialog","services/util"],function(e,n){return{iSiPad:function(){return navigator.userAgent.match(/ipad/gi)},iSwIn10:function(){return navigator.userAgent.match(/Windows NT 10.0/i)},isMac:function(){return/macintosh|mac os x/i.test(navigator.userAgent)},openDialogQr:function(){var t;t=this.iSiPad()?{innerHTML:this.getIpadTemp(),height:190,width:430}:n.isWinClient()?{innerHTML:this.getWin10Temp(),height:190,width:430}:this.isMac()>0?{innerHTML:this.getMacTemp(),height:190,width:430}:{content:this.getPcTemp(),height:330,width:312,title:"更多功能请下载好书荐读客户端"};var i=new e(t);i.showModal(),$(".iPad-dialog-header").on("click",function(){i.close()}),this.iSiPad()&&$("div.iPad-dialog i.icon-hd-download").on("click",function(){window.location.href="http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_hd&utm_medium=tanceng&utm_campaign=hd"}),n.isWinClient()&&$("div.win10-dialog i.icon-win10-download").on("click",function(){window.open("http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_win&utm_medium=tanceng&utm_campaign=win")}),this.isMac()&&$("div.mac-dialog i.icon-mac-download").on("click",function(){window.open("http://www.budejie.com/budejie/guide.html?pc_hd_tanceng=&utm_source=pc_mac&utm_medium=tanceng&utm_campaign=mac")}),$(".ui-popup-backdrop").on("click",function(){i.close()})},getPcTemp:function(){return'<div class="d-c default" style="width: 310px; ">\n    <div class="d-c-qr">\n        <i class="icon-d-qr"></i>\n    </div>\n    <div class="d-c-txt">扫二维码&nbsp;&nbsp;用手机看百思</div>\n</div>'},getIpadTemp:function(){return'<div class="iPad-dialog" i="dialog">\n<div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download" ></i></div></div>'},getWin10Temp:function(){return'<div class="iPad-dialog win10-dialog" i="dialog"><div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download icon-win10-download" ></i></div></div>'},getMacTemp:function(){return'<div class="iPad-dialog mac-dialog" i="dialog"><div class="iPad-dialog-header"><i class="icon-hd-dialog-close"></i></div><div class="iPad-dialog-c"><i class="icon-hd-download icon-mac-download" ></i></div></div>'},openDiffDialogQr:function(n,t,i){var o=e({title:n,content:this.getPcDiffTemp(t,i),height:330,width:312});o.showModal(),$(".ui-popup-backdrop").on("click",function(){o.close()})},getPcDiffTemp:function(e,n){return'<div class="d-c default" style="width: 310px; ">\n    <div class="d-c-qr">\n        <i class="icon-d-qr '+e+'"></i>\n    </div>\n    <div class="d-c-txt">'+n+"</div>\n</div>"},openVideoDialog:function(){}}}),define("services/ajax",["services/util"],function(e){return{url:"http://api.budejie.com/api/api_open.php",$post:function(e,n,t){return this.$ajax(this.getConfig(e,n,t,"POST"))},$get:function(e,n,t){return this.$ajax(this.getConfig(e,n,t,"GET"))},$jsonp:function(e,n,t){var i={data:this.getParams(e)+"&callback=?",dataType:"JSONP",url:n};return this.$ajax(_.isObject(t)&&"[object File]"!==String(t)?$.extend({},i,t):i)},getParams:function(n){return _.isObject(n)&&"[object File]"!==String(n)?e.params(n):n},getConfig:function(e,n,t,i){var o=_.isUndefined(n)||n.length<=0?{data:this.getParams(e)+"&callback=?",dataType:"JSONP",xhrFields:{withCredentials:!0}}:{data:this.getParams(e),url:n,type:i};return _.isObject(t)&&"[object File]"!==String(t)?$.extend({},o,t):o},$ajax:function(e){var n=$.Deferred();return $.ajax($.extend({},{type:"GET",url:this.url,dataType:"json"},e)).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},$ajaxNew:function(e){var n=$.Deferred();return $.ajax($.extend({},{url:"http://d.api.budejie.com/tag/recommend/topic/"+e+"/budejie-android-6.8.0.json",dataType:"jsonp"})).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()}}}),define("services/comment.service",["services/ajax"],function(e){return{getCommentJson:function(n,t,i,o){return e.$get({a:"datalist",per:n,c:"comment",hot:o,appname:"www",client:"www",device:"pc",data_id:t,page:i})},getRePostJson:function(n){var t={order:"repost",c:"data",a:"list",type:"41",per:"10"};return e.$get(_.isUndefined(n)?t:$.extend({},t,{maxtime:n}))},getCommentVideo:function(n,t){return e.$get({},"/topic/"+n+"/comment/"+t+"/")}}}),define("module/detail/detailInfo",[],function(){return{rePid:function(){return $("#hidPid").val()}}}),define("module/detail/loadMore",["services/comment.service","services/dialog","module/detail/detailInfo","services/util","scrollPagination"],function(e,n,t,i){$.fn.fadeInWithDelay=function(){var e=0;return this.each(function(){$(this).delay(e).animate({opacity:1},200),e+=100})};var o=function(){this.page=1,this.$tempHtml=$("#commentTemp").html(),this.$hotTempHtml=$("#hotCommentTemp").html(),this.$recommendTempHtml=$("#recommendTemp").html(),this.$loading=$("#scrollPageLoading"),this.totalPage=0,this.pre=5,this.firstLoad=!0,this.load=!1,this.maxId=void 0,this.timeOut=null,this.$newCommentList=$("#newCommentList"),this.$hotCommentList=$("#hotCommentList"),this.pageIng=0,this.init()};return o.prototype={init:function(){this.loadComment(t.rePid(),1)},loadContent:function(){var n=this,o=$("#newCommentList");o.scrollPagination({scrollTarget:$(window),heightOffset:1e3,beforeLoad:function(){n.$loading.fadeIn()},afterLoad:function(e){$(e).fadeInWithDelay(),n.$loading.hide(),n.load=!1},loadContent:function(s){return!n.load&&n.pageIng!=n.page&&(clearTimeout(n.timeOut),void(n.timeOut=setTimeout(function(){e.getCommentJson(n.pre,t.rePid(),n.page,0).then(function(e){n.load=!0,n.pageIng=n.page;var t=e.data?e.data.length:0;if(null===e||t<=0)return n.$newCommentList.stopScrollPagination(),!1;var a=_.template(n.$tempHtml,{variable:"comment"}),d=a(e);if($(d).appendTo(n.$newCommentList),e.data.length>=n.pre-1&&n.$newCommentList.append(n.$recommendTempHtml),i.gaSend("pc官网-加载下一页","加载第"+n.page+"页",""),n.page=n.page+1,n.bindEvent().newEvent(),t>0&&t<n.pre&&(n.$newCommentList.stopScrollPagination(),$("#commentNoMoreMsg").show()),null!=s.afterLoad){var r=o.children("[rel!=loaded]");s.afterLoad.call(o,r)}},function(e){n.$newCommentList.stopScrollPagination(),n.$newCommentList.fadeOut()})},120)))}})},loadComment:function(n,t){var o=this;if(o.pageIng===t||o.pageIng==o.page||o.load)return!1;e.getCommentJson(o.pre,n,t,1).then(function(e){o.load=!0,o.pageIng=t;var n=e.data?e.data.length:0;if(null===e||n<=0)return o.$newCommentList.stopScrollPagination(),!1;if($("#noCommentMsg").hide(),$(".new-comment-title").show(),null!=e.hot&&e.hot.length>0){var s=_.template(o.$hotTempHtml,{variable:"comment"}),a=s(e.hot);$(a).appendTo($("#hotCommentList")),$("#hotComment").show(),o.bindEvent().hotEvent()}e.no=1,s=_.template(o.$tempHtml,{variable:"comment"}),a=s(e),$(a).appendTo(o.$newCommentList),e.data.length>=o.pre-1&&o.$newCommentList.append(o.$recommendTempHtml),n>0&&n<o.pre&&(o.$newCommentList.stopScrollPagination(),$("#commentNoMoreMsg").show()),i.gaSend("pc官网-加载下一页","加载第1页",""),o.page=t+1,o.bindEvent().newEvent(),o.load=!1,o.loadContent(),o.bindSecondCommendEvent()},function(e){o.$newCommentList.stopScrollPagination(),o.$newCommentList.fadeOut()})},bindEvent:function(){var e=this;return{newEvent:function(){e.$newCommentList.find(".icon-up.j-u-dialog").unbind().on("click",function(){}),$(".comment-repost .j-item").unbind().on("click",function(){var e=$(this).find("a");i.gaSend("pc官网-推荐内容点击","内容页评论中推荐内容点击",i.gaTemp("","",e.data("title"),e.data("id")))})},hotEvent:function(){e.$hotCommentList.find(".icon-up.j-u-dialog").unbind().on("click",function(){})}}},bindSecondCommendEvent:function(){setTimeout(function(){$("#ENGAGEYA_WIDGET_28 a.eng_widget_href").on("click",function(){var e=$(this),n=e.attr("href").match("detail-(\\d+).html")||"";n&&(n=n[1]||""),console.log(i.gaTemp("","",e.attr("title"),n)),i.gaSend("pc官网-推荐内容点击","左推荐列表2-GoingNative的推荐内容",i.gaTemp("","",e.attr("title"),n))})},500)}},{init:function(){new o}}}),define("services/player",["jwplayer","services/util","store","slide"],function(e,n,t){var i=function(e,n,t,i,o){this.width=566,this.height=360,this.type=i,this.poster=t,this.mediaSrc=n,this.id=e,this.pid=o,this.playerInstance=null,!_.isUndefined(this.id)&&this.id.length>0&&this.init()};return i.prototype={init:function(){var i=this,o="audio"===this.type?"skin/five-audio.xml":"skin/five-video.xml";this.playerInstance=e(this.id),this.playerInstance.setup({flashplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer.flash.swf",file:this.mediaSrc,image:this.poster,skin:"http://wimg.spriteapp.cn/pc/jwplayer/"+o,width:this.width,height:this.height,events:{onComplete:function(){i.ended();var e=$("#"+i.id).parents(".j-video-c"),o=e.data("id");t.get("w3_ga_play_ended_"+o)||(n.gaSend("视频播放行为统计-按浏览器去重","视频播放结束",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),o)+"|"+e.data("videomlen")),t.set("w3_ga_play_ended_"+o,o)),n.gaSend("pc官网-推荐内容显示","视频播放完成后显示更多视频",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),o)+"|"+e.data("videomlen"))},onVolume:function(){},onReady:function(){i.ready()},onPlay:function(){i.play();var e=$("#"+i.id).parents(".j-video-c"),o=e.data("id");t.get("w3_ga_play_playing_"+o)||(n.gaSend("视频播放行为统计-按浏览器去重","点击播放按钮",n.gaTemp(e.data("date"),e.data("time"),e.data("title"),o)+"|"+e.data("videomlen")),t.set("w3_ga_play_playing_"+o,o))},onPause:function(){},onBufferChange:function(){},onBufferFull:function(){},onError:function(e){console.log(e.message);var t=$("#"+i.id).parents(".j-video-c");n.gaSend("视频播放错误",e.message,n.gaTemp(t.data("date"),t.data("time"),t.data("title"),t.data("id"))+"|"+t.data("videomlen"))},onFullscreen:function(e){e.fullscreen},onMute:function(e){}}})},play:function(){var n=$(".j-video-c"),t=n.find(".jwplayer"),i=this;$.each(t,function(){var n=$(this).attr("id");i.id!=n&&e(n).stop()})},ended:function(){if("video"===this.type){var n=$("#"+this.id).parents(".j-video-c").find(".j-v-d-c"),t=this;n.length>0&&(e("jDownloadVideo").play(),n.show(),n.find(".icon-replay").on("click",function(){n.hide(),e(t.id).play()}))}},ready:function(){if("video"===this.type){var e=$("#j-v-container-"+this.pid);if(e.length>0){e.find(".tempWrap").length<=0&&e.find(".slideBox").slide({mainCell:".bd > ul",effect:"leftLoop",autoPlay:!1,trigger:"click",easing:"swing",delayTime:1e3,slideW:566,mouseOverStop:!0,pnLoop:!1})}}}},{init:function(e,n,t,o,s){return new i(e,n,t,o,s)},setup:function(){$("#jDownloadVideo").length<=0||e("jDownloadVideo").setup({flashplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer.flash.swf",file:"http://wvoice.spriteapp.cn/voice1/download.mp3",image:"http://mpic.spriteapp.cn/crop/152x93/picture/2015/0624/558a9dce3541d.jpg",skin:"http://wimg.spriteapp.cn/pc/jwplayer/skin/five-audio.xml",width:0,height:0,controls:!1})}}}),define("services/toolbar",["services/ajax","store"],function(e,n){return{love:function(t,i){if(!n.get("u_ding_cai_"+i)&&!$(t).hasClass("active")&&!$(t).hasClass("active")){var o=$(t).children("span").text().trim();o=Number(o)+1,$(t).addClass("active"),$(t).next("span").addClass("tlargen");var s=$('<div class="ding">+1</div>');s.appendTo($(t)),setTimeout(function(){$(s).remove()},500),$(t).children("span").text(o),n.set("u_ding_cai_"+i,i),e.$get({c:"post",a:"love",cid:i}).then(function(e){console.log(e)})}},nolove:function(t,i){if(!n.get("u_ding_cai_"+i)&&!$(t).hasClass("active")&&!$(t).hasClass("active")){var o=$(t).children("span").text().trim();o=Number(o)+1,$(t).addClass("active"),$(t).next("span").addClass("tlargen"),$(t).children("span").text(o),n.set("u_ding_cai_"+i,i),e.$get({c:"post",a:"cai",id:i}).then(function(e){console.log(e)})}},collect:function(e,t){n.get("u_collect_"+t)||$(e).parent().hasClass("active")||($(e).parent().addClass("active"),n.set("u_collect_"+t,t))},getPid:function(){return $(this).parents(".j-r-list-tool-l").data("id")}}}),define("module/list",["services/toolbar","services/dialog"],function(e,n){return{listEvent:function(){$(".j-r-list-tool-l-up").on("click",function(){e.love(this,e.getPid.call(this));var n=$(this).parents(".j-r-list-tool-l").data("id");try{_BFD.Approval(0,n)}catch(e){}}),$(".u-dian  .icon-up").on("click",function(){}),$(".j-r-list-tool-l-down ").on("click",function(){e.nolove(this,e.getPid.call(this));var n=$(this).parents(".j-r-list-tool-l").data("id");try{_BFD.Opposition(0,n)}catch(e){}}),$(".icon-comment").on("click",function(){$(this).parent().hasClass("active")||$(this).parent().addClass("active")}),$(".icon-cc").on("click",function(){}),navigator.userAgent.match(/ipad/gi)&&($(".j-down-hide").removeClass("ipad-hide"),$(".ipad-down-href").attr("href","javascript:;"),$(".j-down-hide").on("click",function(){if(console.log("dian"),confirm("需前往迅雷下载视频，确定前往？")){var e=$("#ipad-downvideo-href").val();$(this).children(".ipad-down-href").attr("href",e),document.location.href=e}})),$(".ipad-hide").on("click",function(){n.openVideoDialog()})}}}),define("module/common",["services/player","module/list","services/util","scrollUp"],function(player,list,util){var common={iSiwIn10:function(){return navigator.userAgent.match(/Windows NT 10.0/i)},isMac:function(){return/macintosh|mac os x/i.test(navigator.userAgent)},iSiPad:function(){return navigator.userAgent.match(/ipad/gi)},scrollInit:function(){$.scrollUp({animation:"slide"})},playerInit:function(){$.each($(".j-video"),function(){var e=$(this);player.init(e.attr("id"),e.data("mp4"),e.data("poster"),"video",e.data("id"))}),$.each($(".j-audio"),function(){var e=$(this);player.init(e.attr("id"),e.data("mp3"),e.data("poster"),"audio",e.data("id"))}),player.setup()},lazyLoad:function(){$("div.lazy,img.lazy").lazyload({effect:"fadeIn",event:"scrollstop",threshold:1200}),$("img.lazy").lazyload({effect:"fadeIn",event:"scrollstop",threshold:20,container:$(".g-sd")})},fixedRight:function(){$(document).on("scroll",function(){function e(e){t.hasClass("bd-fixed")&&l!=e+"px"&&t.css({top:e}),!t.hasClass("bd-fixed")&&t.addClass("bd-fixed").css({top:e})}var n=$(window),t=$(".j-l-c"),i=t.outerHeight(),o=$(".j-footer"),s=o.offset().top,a=n.height(),d=i-a,r=s-a,c=parseInt(n.scrollTop()),l=t.css("top"),u=$(".g-mn").outerHeight();if(u>i&&c>d){var p=i-a;c<r&&e(-[p+5]),c>r&&e(-[p+345])}u>i&&c<d&&t.hasClass("bd-fixed")&&t.removeClass("bd-fixed ").css({top:0})})},showDownload:function(){util.isWinClient()&&$(".j-win10-button").css("display","block")},showDownloadMac:function(){this.isMac()&&!this.iSiPad()&&$(".j-mac-button").css("display","block")},gaEvent:function(){$(".j-everyone .j-item").on("click",function(){var e=$(this).find("a");util.gaSend("pc官网-推荐内容点击","右侧“大家都在看”推荐视频点击",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")))}),$(".j-jq-hot .j-item").on("click",function(){var e=$(this).find("a");util.gaSend("pc官网-推荐内容点击","右侧“近期热门”推荐视频点击",util.gaTemp("","",e.data("title"),e.data("id")))}),$(".index-wrst .j-item").on("click",function(){var e=$(this).find("a");util.gaSend("pc官网-推荐内容点击"," 帖子流中推荐内容点击",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")))}),$(".detail-wst .j-item").on("click",function(){var e=$(this).find("a");util.gaSend("pc官网-推荐内容点击"," 内容页正文下“往日神帖”推荐内容点击",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")))}),$(".slideBox .m-list4 li").on("click",function(){var e=$(this).find("a");util.gaSend("pc官网-推荐内容点击","视频播放完成后点击更多视频",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")))}),$(".bdsharebuttonbox a").on("click",function(){SHAREID=$(this).parent().data("id")}),$(".bdsharebuttonbox a.bds_more").on("mouseover",function(){SHAREID=$(this).parent().data("id")}),$(".j-collect").on("click",function(){util.gaSend("pc官网-收藏帖子","弹层提示安装App","")}),$("a.j-list-comment").on("click",function(){var e=$(this).parents(".j-r-list-tool");util.gaSend("pc官网-查看评论",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")),util.gaType(e.data("type"),e.data("video_mlen")))}),$(".icon-review").on("click",function(){util.gaSend("pc官网-点击审稿按钮","弹层提示安装App","")}),$(".c-next-btn-content .c-prev-btn").on("click",function(){var e=$(this);util.gaSend("pc官网-推荐内容点击","上一条",util.gaTemp("","","",e.data("id")))}),$(".c-next-btn-content .c-next-btn").on("click",function(){var e=$(this);util.gaSend("pc官网-推荐内容点击","下一条",util.gaTemp("","","",e.data("id")))}),$(".j-down-video a").on("click",function(){var e=$(this).parents(".j-r-list-tool");util.gaSend("pc官网-下载视频",util.gaTemp(e.data("date"),e.data("time"),e.data("title"),e.data("id")),"")}),$(".icon-win10-download").on("click",function(){util.gaSend("pc官网-下载win10","下载弹层的下载button点击","")}),$(".j-win10-button").on("click",function(){util.gaSend("pc官网-下载win10","右侧二维码下的下载button点击","")}),$(".icon-mac-download").on("click",function(){util.gaSend("pc官网-下载mac","下载弹层的下载button点击","")}),$(".j-mac-button").on("click",function(){util.gaSend("pc官网-下载mac","右侧二维码下的下载button点击","")})},initBDShare:function(){with(window._bd_share_config={common:{bdText:"{{topic.text|escapejs}}",bdDesc:"{{topic.text|escapejs}}",bdUrl:window.location.href,bdPic:'{{topic.thumbnail_abs_uri|default:"http://img.spriteapp.cn/www/images/budejie-icon-180x180.jpg"}}',onBeforeClick:function(e,n){var t=$(".fx-bd-"+SHAREID),i=t.parents(".j-r-list-tool");_BFD.Review(0,t.data("id")),util.gaSend("pc官网-分享帖子",util.gaTemp(i.data("date"),i.data("time"),i.data("title"),i.data("id")),util.gaType(i.data("type"),i.data("video_mlen")));try{window._BFD=window._BFD||{},_BFD.Share(0,i.data("id"),util.getCookie("tma"),util.getCookie("tmc"),util.getCookie("tmd"))}catch(e){}return console.log(e),$.extend({},n,{bdText:t.data("text"),bdDesc:t.data("text"),bdUrl:"http://www.budejie.com"+t.data("url"),bdPic:t.data("pic")})},onAfterClick:function(e){}},share:[{bdSize:24,bdStyle:"1"}]},document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date/36e5)}};return{init:function(){common.initBDShare(),common.scrollInit(),common.playerInit(),common.lazyLoad(),common.fixedRight(),list.listEvent(),common.gaEvent(),common.showDownload(),common.showDownloadMac()}}}),define("module/detail/longText",["services/ajax","module/detail/detailInfo"],function(e,n){var t=function(){this.$content=$(".j-r-list-c-long_content"),this.$content.length>0&&this.init()};return t.prototype={init:function(){var e=this;e.getJson().then(function(n){e.filter(n.richtxt.text)},function(n){e.$content.text("这个长文没有内容")})},getJson:function(){return e.$get({a:"detail",c:"data",id:n.rePid(),style:1,type:"51",extend:1})},filter:function(e){var n=this,t=$(e),i=(t.filter("img").length>0||t.filter("p").length>0)&&0==t.has("div").length?t:t.find("h1,h2,h3,h4,h5,h6,p,img");this.$content.html(i),this.$content.children().each(function(e,t){var i=$(t);if(i.removeAttr("style"),"IMG"!=String(t.tagName))t.innerText=void 0!=t.innerText?t.innerText.trim():"",""!=t.innerHTML.trim()&&"<br>"!=t.innerHTML.trim()||t.parentNode.removeChild(this),i.children("span").length>0&&(t.innerHTML=t.innerText),(i.text().indexOf("微信号")>-1||i.text().indexOf("回复")>-1||i.text().indexOf("扫一扫")>-1||i.text().indexOf("获取更多")>-1)&&t.parentNode.removeChild(this),n.$content.find(".qr_code_pc_img").hide();else if(""==t.src||void 0==t.src||""==t.src||t.src==location.href)t.parentNode.removeChild(this);else{var o="http://wimg.spriteapp.cn"+t.getAttribute("bdj_url");t.src=o.replace("?tp=webp","")}})}},{init:function(){new t}}}),define("module/detail",["services/dialog","module/detail/loadMore","module/common","module/detail/longText","services/util"],function(e,n,t,i,o){$(function(){$(".btnSmXz1,.btnSmXz2").unbind().on("click",function(n){n.preventDefault(),e.openDialogQr(),n.stopPropagation()}),$("#userRepty").on("click",function(){o.gaSend("pc官网-发表评论","弹层提示安装App","")}),t.init(),n.init()})}),define("module/user/validate",[],function(){return{common:function(){return{errorPlacement:function(e,n){n.parents(".j-u-c-input").addClass("j-v-error").after(e)},success:function(e){var n=e.prev();n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}}}}}),define("services/user/user.service",["services/ajax"],function(e){return{serviceStatic:"http://d.api.budejie.com",login:function(n,t){return e.$jsonp({phonenum:n,password:md5(t)},this.serviceStatic+"/user/login")},register:function(n,t,i){return e.$jsonp({username:n,password:md5(t),verify_code:i},this.serviceStatic+"/user/register")},restPwd:function(n,t){return e.$jsonp({password:md5(n),re_password:md5(t)},this.serviceStatic+"/user/reset_password")},findPwd:function(n,t,i){return e.$jsonp({username:n,password:md5(t),verify_code:i},this.serviceStatic+"/user/register")},sendCode:function(n,t,i){return e.$jsonp({phonenum:n,verifytype:t,code:i},this.serviceStatic+"/user/getverifycode")},checkVerify:function(n,t){return e.$jsonp({phonenum:n,verify_code:t,verifytype:"reset_password"},this.serviceStatic+"/user/checkverify")},loginOut:function(){return e.$jsonp({client:"pc"},this.serviceStatic+"/user/logout")},getInfo:function(){return e.$jsonp({},this.serviceStatic+"/user/profile")},getUserInfoById:function(n){return e.$jsonp({a:"profile",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},getFansList:function(n,t){return e.$jsonp({a:"fans_list",c:"user",follow_id:t,userid:n},"http://api.budejie.com/api/api_open.php")},getFollowList:function(n,t){return e.$jsonp({a:"follow_list",c:"user",follow_id:t,userid:n},"http://api.budejie.com/api/api_open.php")},follow:function(n){return e.$jsonp({a:"follow",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},unFollow:function(n){return e.$jsonp({a:"unfollow",c:"user",userid:n},"http://api.budejie.com/api/api_open.php")},getNewsList:function(n,t,i,o){return e.$jsonp({a:"msgcenter",c:"msg",appname:"baisishequ",from:"www",page:t,per:i,uid:n,max:o,ver:"4.0",client:"ios"},"http://api.budejie.com/api/api_open.php")}}}),define("services/message",["dialog"],function(e){return{alert:function(n){e({title:"操作提示",content:n}).show()},msg:function(n,t){var i=t||2e3,o=e({skin:"j-msg",title:"操作提示",content:n});o.show(),setTimeout(function(){o.close().remove()},i)}}}),define("module/user/user.info",["services/user/user.service","services/message","dialog","services/util"],function(e,n,t,i){function o(){this.getInfo(),this.$loginBar=$("#jLoginBar"),this.$jUserLoginBar=$("#jUserLoginBar"),this.$userInfo=$("#userInfo"),this.$userFollow=$("#userFollow"),this.$userFans=$("#userFans"),this.$userNewsIcon=$("#userNewsIcon"),this.$userNewsHtml="",this.$jTitle=$("#jTitle"),this.location=window.location}function s(e){var n=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==n||n.length<1?null:n[1]}return o.prototype.getInfo=function(){var n=e.getUserInfoById(),t=this;n.then(function(e){if(e&&(t._rightUserInfo(e),t._rightUserFollow(e),t._rightUserFans(e),t._topUserNews(e),t.auth(e),0==e.code)){var n=_.escape(e.data.username);t.bind(n.length>9?n.substring(0,8)+"...":n,n)}})},o.prototype._len=function(e){return e.replace(/[^\x00-\xff]/g,"**").length},o.prototype.bind=function(e,n){console.log(e),this.$loginBar.hide(),this.$jUserLoginBar.find("#jUserLoginName").text(e).attr("title",n),this.$jUserLoginBar.show(),this._event()},o.prototype._event=function(){var i=$("#jLoginExit"),o=this;i.length>0&&i.on("click",function(){e.loginOut().then(function(e){e&&0==e.result&&(n.msg(e.result_desc),o.$loginBar.show(),o.$jUserLoginBar.hide(),o.location.reload())})}),o.$userNewsIcon.length>0&&o.$userNewsIcon.on("click",function(){t({padding:0,quickClose:!0,content:o.$userNewsHtml}).show(document.getElementById("userNewsIcon"))})},o.prototype.auth=function(e){var n=this;if(0!=e.code&&"True"==jie.is_oauth_login&&(n.location.href="/user/login?r_url="+encodeURI(n.location.href)),0==e.code&&"True"==jie.is_login_page){var t=s("r_url");n.location.href=null!=t?t:"http://www.budejie.com"}},o.prototype._rightUserInfo=function(n){var t=this;if(t.$userInfo.length>0)if(window.JIE=window.JIE||{},!_.isUndefined(JIE.userId)&&JIE.userId.length>0)e.getUserInfoById(JIE.userId).then(function(e){if(e){e.data.username=_.escape(e.data.username),e.data.introduction=_.escape(e.data.introduction);var n=_.template(t._rightOtherUserInfoTemp(),{variable:"user"}),i=n(e.data);t.$userInfo.html(i),t._followEvent(),t._updateTitle(e.data.username)}});else if(0==n.code){n.data.username=_.escape(n.data.username),n.data.introduction=_.escape(n.data.introduction);var i=_.template(t._rightUserInfoTemp(),{variable:"user"}),o=i(n.data);t.$userInfo.html(o),t._updateTitle(n.data.username)}},o.prototype._rightUserFollow=function(n){var t=this;if(t.$userFollow.length>0){window.JIE=window.JIE||{};var i=0,o=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(i=JIE.userId,o=!0):(i=n.id,o=!1);e.getFollowList(i,0).then(function(e){if(e&&0==e.code){var n=e.data;n.list=$(n.list).slice(0,5);for(var i=0;i<n.list.length;i++)n.list[i].username=_.escape(n.list[i].username),n.list[i].username.length>3&&(n.list[i].username=n.list[i].username.substring(0,2)+"...");n.isOthers=o;var s=_.template(t._rightUserFollowTemp(),{variable:"follow"}),a=s(n);t.$userFollow.html(a)}})}},o.prototype._rightUserFans=function(n){var t=this;if(t.$userFans.length>0){window.JIE=window.JIE||{};var i=0,o=!1;!_.isUndefined(JIE.userId)&&JIE.userId.length>0?(i=JIE.userId,o=!0):(i=n.id,o=!1);e.getFansList(i,0).then(function(e){if(e&&0==e.code){var n=e.data;n.list=$(n.list).slice(0,5);for(var i=0;i<n.list.length;i++)n.list[i].username=_.escape(n.list[i].username),n.list[i].username.length>3&&(n.list[i].username=n.list[i].username.substring(0,2)+"...");n.isOthers=o;var s=_.template(t._rightUserFansTemp(),{variable:"fans"}),a=s(n);t.$userFans.html(a)}})}},o.prototype._topUserNews=function(n){var t=this;if(t.$userNewsIcon.length>0){e.getNewsList(n.data.id,1,5,0).then(function(e){if(e){var n=_.template(t._topUserNewsTemp(),{variable:"news"}),i=n(_.map(e.list,function(e){var n={};return n.ctime=e.ctime,"url_topic"==e.type||"system"==e.type?n.title="系统消息:"+_.escape(e.body):n.title=_.escape(e.title),n.title.length>14&&(n.title=_.escape(n.title.substring(0,14))+"..."),e.pinfo&&(n.id=e.pinfo.id),n}));t.$userNewsHtml=i}})}},o.prototype._followEvent=function(){var t=this;t.$userInfo.find(".j-follow").on("click",function(){var o=$(this),s=o.data("userid");i.gaSend("pc官网-关注好友","点击关注button",""),t._isLogin(function(){e.follow(s).then(function(e){console.log(e),o.hide(),o.next().show(),n.msg(e.msg)})})}),t.$userInfo.find(".j-un-follow").on("click",function(){var o=$(this),s=o.data("userid");i.gaSend("pc官网-取消关注好友","点击取消关注button",""),t._isLogin(function(){e.unFollow(s).then(function(e){console.log(e),o.hide(),o.prev().show(),n.msg(e.msg)})})})},o.prototype._rightUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/topic/" title="<%= user[\'username\'] %>" class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},o.prototype._rightOtherUserInfoTemp=function(){return'<div class="p-age-img">\n    <a href="">\n        <img class="p-logo" src="<%= user[\'profile_image\'] %>" alt=""/>\n    </a>\n</div>\n<div class="p-age-mess">\n    <div class="p-age-name">\n        <a href="/user/others-<%= user[\'id\'] %>.html"  title="<%= user[\'username\'] %>"  class="p-age-netname"><%= user[\'username\'].length > 5 ? user[\'username\'].substring(0,5)+\'...\' : user[\'username\'] %></a>\n        <i class="icon-rank"></i>\n        <%if (user.relationship == \'0\' || user.relationship == \'3\' ) { %>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow">+ 关注</a>\n        <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow" style="display: none;">取消关注</a>\n        <% } %>\n        <%if (user.relationship == \'2\' || user.relationship == \'4\') { %>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus j-follow"  style="display: none;">+ 关注</a>\n         <a href="javascript:void(0);" data-userid="<%= user[\'id\'] %>" class="focus cancel-focus j-un-follow">取消关注</a>\n        <% } %>\n    </div>\n    <div class="p-age-lein">\n        <span class="level">等级：<%= user[\'level\'] %></span>\n        <span class="integral">积分：<%= user[\'credit\'] %></span>\n    </div>\n    <div class="signature">简介：<%= user[\'introduction\'] || \'这家伙很懒，神马都木有写\' %></div>\n</div>'},o.prototype._rightUserFollowTemp=function(){return'<div class="p-age-attente-title"><span>关注（<%= follow[\'info\'][\'count\']%>人）</span><a href="/user/follow/<%= follow.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(follow[\'list\']) > 0) { _.each(follow[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有关注人哦</li><% } %></ul>'},o.prototype._rightUserFansTemp=function(){return'<div class="p-age-attente-title"><span>粉丝（<%= fans[\'info\'][\'count\']%>人）</span><a href="/user/fans/<%= fans.isOthers ? JIE.userId : \'\'%>" class="p-age-all">全部</a></div><ul class="p-age-attente-con"><% if (_.size(fans[\'list\']) > 0) { _.each(fans[\'list\'], function(item) { %><li><a href="/user/others-<%= item[\'id\']%>.html"><img class="follower-img" src="<%= item[\'profile_image\'] %>" onerror="this.src=\'http://wimg.spriteapp.cn/profile/\'" alt=""/></a><a href="/user/others-<%= item[\'id\']%>.html?topic_type=publish" class="follower-name"><%= item[\'username\'] %></a></li><% });} else { %><li class="p-age-attente-none">还没有粉丝哦</li><% } %></ul>'},o.prototype._topUserNewsTemp=function(){
return"<div class=\"j-new-box\"><ul><% if (_.size(news) > 0) { _.each(news, function(item) { %><li><a href=\"<%= item['id'] == undefined ? '/user/news' : '/detail-' + item['id'] + '.html' %>\"><%= item['title']%></a></li><% });} else { %><li class=\"j-new-none-msg\">没有消息提醒</li><% } %><li class=\"j-new-more\"><a href=\"/user/news\">查看更多</a></li></ul></div>"},o.prototype._isLogin=function(n){e.getInfo().then(function(e){1==e.code?(window.JIE=window.JIE||{},JIE.openLoginDialog()):n&&n.call()})},o.prototype._updateTitle=function(e){this.$jTitle.length>0&&(window.JIE=window.JIE||{},JIE.isUpdateTitle&&this.$jTitle.text(this.$jTitle.text().replace("@userName@",e)))},o}),define("module/user/findpwd",["dialog","services/ajax","module/user/validate","services/user/user.service","services/message","module/user/user.info"],function(e,n,t,i,o,s){function a(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return a.prototype.open=function(){var n=this,t=e.get("j-find");if(!_.isUndefined(t))return void t.showModal();n.dlg=new e({id:"j-find",fixed:!0,innerHTML:this.temp(),height:340,width:594}),n.dlg.showModal(),n.event();var i=n.validate();n.sendCode(i),$("input, textarea").placeholder()},a.prototype.opens=function(){var n=this,t=e.get("j-finds");if(!_.isUndefined(t))return void t.showModal();this.dlg=new e({id:"j-finds",fixed:!0,innerHTML:this.temps(),height:340,width:594}),n.dlg.showModal(),$("#jFindDCles").on("click",function(){n.dlg.close()}),n.validates(),$("input, textarea").placeholder()},a.prototype.temp=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFind">\n                <div class="j-u-d-c-one  j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span>+86 <input type="text" placeholder="请输入手机号" name="username" class="j-u-d-c-p-con j-findpwd-telephone" id="findTxtUserName">\n                    </div>\n                    </div>\n                <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符"  name="vcode" class="j-u-d-c-p-con" id="txtFindVCode">\n                    </div><div id="jFindVCode" class="j-u-d-c-vcode"><img id="jFindVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div>\n                </div><div class="j-u-d-c-one j-u-d-c-two j-u-d-c-code">\n                    <div class="j-u-d-c-phone j-u-d-f-input j-u-d-fl">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"  name="code" class="j-u-d-c-p-con" id="findCode">\n                    </div>\n                <div class="j-u-d-c-code" id="jGetCode">获取验证码</div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindSubmit" class="j-u-d-submit j-code-submit">提交</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.temps=function(){return'<div class="j-ui-dialog j-pwd">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">找回密码</div>\n        <span class="j-u-d-h-close" id="jFindDCles"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffFinds">\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password" placeholder="请输入密码" class="j-u-d-c-p-con" name="password" id="password">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-three">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">确认密码 |  </span><input type="password" placeholder="请再次输入密码确认" class="j-u-d-c-p-con" name="apassword" id="apassword">\n                    </div>\n                </div>\n                <a href="javascript:void(0);" id="btnFindsSubmit" class="j-u-d-submit">确定</a>\n            </form>\n        </div>\n    </div>\n</div>\n'},a.prototype.event=function(){var e=this;$("#jFindDCle").on("click",function(){e.dlg.close()})},a.prototype.sendCode=function(e){var n=this,t=$("#jFindVCodeImg");t.attr("src",n.vCodeUrl+"?t="+(new Date).getTime()),$("#jFindVCode").on("click",function(){t.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())}),$("#jGetCode").on("click",function(){var s=$.trim($("#findTxtUserName").val()),a=$.trim($("#txtFindVCode").val());if(s.length<=0||!/^1\d{10}$/.test(s))return void e.element("#findTxtUserName");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtFindVCode");if(!(n.seconds>0&&n.seconds<60||n.codeIsSend)){i.sendCode(s,"reset_password",a).then(function(e){e&&(0==e.code?(o.msg("验证码发送成功！"),n.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,o.msg("提示:"+e.msg),t.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())))})}})},a.prototype.disabledSendBtn=function(){var e=$("#jGetCode"),n=this,t=setInterval(function(){n.seconds--,e.text(n.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==n.seconds&&(clearInterval(t),n.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),n.codeIsSend=!1)},1e3)},a.prototype.validate=function(){var e=this,n=$("#ffFind"),t=n.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,n){n.parents(".j-u-d-f-input").addClass("j-v-error").parents(".j-u-d-c-code").after(e)},success:function(e){var n=e.prev().find(".j-u-d-f-input");n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}});return $("#btnFindSubmit").on("click",function(){if(n.valid()){var s=$("#findTxtUserName"),a=$("#findCode");t.resetForm();i.checkVerify(s.val(),a.val()).then(function(n){n&&(1e3==n.code?(e.dlg.close(),e.opens()):(n.msg="验证码错误"==n.msg?"短信验证码错误":n.msg,o.msg("提示:"+n.msg)))},function(){o.msg("网络超时,请稍后重试！")})}}),n.keydown(function(e){13==e.keyCode&&$("#btnFindSubmit").trigger("click")}),t},a.prototype.validates=function(){var e=$("#ffFinds"),n=e.validate($.extend({},t.common(),{rules:{password:{required:!0,minlength:6,maxlength:16},apassword:{required:!0,equalTo:"#password"}},messages:{password:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"},apassword:{required:"密码不能为空",equalTo:"两次输入的密码不一致,请重新输入"}}}));return $("#btnFindsSubmit").on("click",function(){if(e.valid()){var t=$("#password"),s=$("#apassword");n.resetForm();i.restPwd(t.val(),s.val()).then(function(e){e&&(1e3==e.code?(o.msg("修改密码成功"),window.location.reload()):o.msg(e.msg))},function(){o.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&$("#btnFindsSubmit").trigger("click")}),n},a}),define("module/user/login",["dialog","module/user/findpwd","services/util","module/user/validate","module/user/user.info","services/user/user.service","services/message"],function(e,n,t,i,o,s,a){function d(){this.dlg=null}return d.prototype.open=function(){var n=this,t=e.get("j-Login");return _.isUndefined(t)?(n.dlg=new e({id:"j-Login",fixed:!0,innerHTML:this.temp(),height:393,width:740}),n.dlg.showModal(),n.event(),$("input.j-u-d-c-p-con").placeholder(),n.remindMe(),n.findPwd(),void n.validate()):void t.showModal()},d.prototype.close=function(){this.dlg.close()},d.prototype.temp=function(){return'<div class="j-ui-dialog j-regist j-login" >\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">登录</div>\n        <span class="j-u-d-h-close" id="jLoginDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffLogin">\n                <div class="j-u-d-c-one j-u-d-c-spe">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                            <span class="j-u-d-c-p-tit">账&nbsp;&nbsp;&nbsp;&nbsp;号 |  </span>\n                            <input id="txtUserName" name="username" type="text" placeholder="手机号" class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input id="txtUserPwd" name="userpwd" type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con">\n                    </div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me" id="jRemindMe">\n                        <span class="icon-checkbox "></span>\n                        &nbsp;&nbsp;姐，记住我\n                    </label>\n                    <a class="forget-password" id="jForgetPwd">忘记密码</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit j-u-d-login">登录</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-regist-des">还没有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_L_Register">注册</span>\n            </div>\n        </div>\n    </div>\n</div>'},d.prototype.event=function(){var e=this;$("#jLoginDCle").on("click",function(){e.dlg.close()})},d.prototype.remindMe=function(){var e=$("#jRemindMe"),n=e.find("span.icon-checkbox"),t=$.cookie("bdj_username"),i=$("#txtUserName"),o=$("#txtUserPwd");void 0!=t&&(!n.hasClass("icon-checkbox-click")&&n.addClass("icon-checkbox-click"),i.val(t),o.val($.cookie("bdj_user_pwd"))),e.on("click",function(){n.hasClass("icon-checkbox-click")?(n.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"})):(n.addClass("icon-checkbox-click"),$.cookie("bdj_username",i.val(),{path:"/"}),$.cookie("bdj_user_pwd",o.val(),{path:"/"}))}),i.keyup(function(){!/^1\d{10}$/.test($(this).val())&&n.hasClass("icon-checkbox-click")&&(n.removeClass("icon-checkbox-click"),$.removeCookie("bdj_username",{path:"/"}),$.removeCookie("bdj_user_pwd",{path:"/"}))})},d.prototype.findPwd=function(){var e=this;$("#jForgetPwd").on("click",function(){e.dlg.close(),(new n).open(),t.gaSend("pc官网-点击忘记密码","忘记密码","")})},d.prototype.validate=function(){var e=$("#ffLogin"),n=$(".j-u-d-login"),o=e.validate($.extend({},i.common(),{rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:6,maxlength:16}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持6-16位数字、字母和符号",maxlength:"密码仅支持6-16位数字、字母和符号"}}}));n.on("click",function(){if(e.valid()){var n=$("#txtUserName"),i=$("#txtUserPwd");o.resetForm();s.login(n.val(),i.val()).then(function(e){e&&(1e3==e.code?(a.msg("登录成功"),t.gaSend("pc官网-点击登录","登录成功",""),window.location.reload()):a.msg(e.msg))},function(){a.msg("网络超时,请稍后重试！")})}}),e.keydown(function(e){13==e.keyCode&&n.trigger("click")})},d}),define("module/user/register",["dialog","module/user/user.info","services/user/user.service","services/message"],function(e,n,t,i){function o(){this.dlg=null,this.seconds=60,this.codeIsSend=!1,this.isAgree=!0,this.vCodeUrl="http://d.api.budejie.com/user/captcha/"}return o.prototype.open=function(){var n=this,t=e.get("j-register");if(!_.isUndefined(t))return void t.showModal();n.dlg=new e({id:"j-register",fixed:!0,innerHTML:this.temp(),height:454,width:772}),n.dlg.showModal(),n.event();var i=n.validate();n.sendCode(i)},o.prototype.close=function(){this.dlg.close()},o.prototype.temp=function(){return'<div class="j-ui-dialog j-regist">\n    <div class="j-ui-dialog-header">\n        <div class="j-u-d-h-title">注册 我要做姐粉</div>\n        <span class="j-u-d-h-close" id="jRegisterDCle"></span>\n    </div>\n    <div class="j-ui-dialog-c">\n        <div class="j-u-d-c-l">\n            <form action="post" id="ffRegister">\n                <div class="j-u-d-c-one j-u-d-c-spe j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">手机号 |  </span><input type="text" placeholder="请输入手机号"\n                                                                         class="j-u-d-c-p-con" name="username" id="txtUserRegistTelephone">\n                    </div>\n                </div>\n                <div class="j-u-d-c-one j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-c-input">\n                        <span class="j-u-d-c-p-tit">密&nbsp;&nbsp;&nbsp;&nbsp;码 |  </span><input type="password"\n                                                                                                placeholder="请输入密码"\n                                                                                                class="j-u-d-c-p-con" name="userpwd"  id="txtUserRegistPwd" >\n                    </div>\n                </div>\n       <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register"><div class="j-u-d-c-phone j-u-d-fl j-u-c-input"><span class="j-u-d-c-p-tit">图片验证码 |  </span><input type="text" placeholder="请输入右边图片中的字符" class="j-u-d-c-p-con" name="vcode" id="txtRegVCode"></div><div id="jRegVCode" class="j-u-d-c-vcode"><img id="jRegVCodeImg" alt="验证码"/><a style="display: block; text-decoration: underline;">点击更换验证码</a></div></div>\n         <div class="j-u-d-c-one j-u-d-c-two j-u-d-c-register">\n                    <div class="j-u-d-c-phone j-u-d-fl j-u-c-input">\n                        <span class="j-u-d-c-p-tit">短信验证码 |  </span><input type="text" placeholder="请输入手机收到的验证码"\n                                                                         class="j-u-d-c-p-con"  name="code" id="txtUserRegistCode">\n                    </div>\n                    <div class="j-u-d-c-code" id="jRegistGetCode">获取验证码</div>\n                </div>\n                <div class="j-u-d-agreement">\n                    <label class="remind-me">\n                        <span class="icon-checkbox icon-checkbox-click"></span>\n                        &nbsp;&nbsp;签署姐的\n                    </label><a href="http://www.budejie.com/budejie/privacy.html" target="_block" class="j-u-d-privacy">注册协议</a>\n                </div>\n                <a href="javascript:void(0);" class="j-u-d-submit" id="btnRegister">注册</a>\n            </form>\n        </div>\n        <div class="j-u-d-c-r">\n            <div class="j-u-d-c-r-login">\n                <span class="j-u-d-icon-login-des">已有账号?</span>\n                <span class="j-u-d-c-icon-login" id="jR_R_Login">登录</span>\n            </div>\n            <div class="joint-login">\n                <span class="j-u-d-icon-joint-login-des">合作账号登陆</span>\n                <ul>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/weibo_login">\n                            <span class="joint-login-xinlang"></span>\n                            <span class="joint-login-tit">新浪微博</span>\n                        </a>\n                    </li>\n                    <li>\n                        <a href="http://d.api.budejie.com/user/qq_login">\n                            <span class="joint-login-xinlang joint-login-qq"></span>\n                            <span class="joint-login-tit">QQ</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n'},o.prototype.event=function(){var e=this;$("#jRegisterDCle").on("click",function(){e.dlg.close()}),$("input, textarea").placeholder();var n=$("#btnRegister");$(".remind-me").click(function(){$(this).find("span").hasClass("icon-checkbox-click")?($(this).find("span").removeClass("icon-checkbox-click"),e.isAgree=!1,n.addClass("j-u-d-submit-disabled")):($(this).find("span").addClass("icon-checkbox-click"),e.isAgree=!0,n.removeClass("j-u-d-submit-disabled"))})},o.prototype.sendCode=function(e){var n=this,o=$("#jRegVCodeImg");o.attr("src",n.vCodeUrl+"?t="+(new Date).getTime()),$("#jRegVCode").on("click",function(){o.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())}),$("#jRegistGetCode").on("click",function(){var s=$.trim($("#txtUserRegistTelephone").val()),a=$.trim($("#txtRegVCode").val());if(s.length<=0||!/^1\d{10}$/.test(s))return void e.element("#txtUserRegistTelephone");if(a.length<=0||!/^\w{4}$/.test(a))return void e.element("#txtRegVCode");if(!(n.seconds>0&&n.seconds<60||n.codeIsSend)){t.sendCode(s,"register",a).then(function(e){e&&(0==e.code?(i.msg("验证码发送成功！"),n.disabledSendBtn()):(e.msg="验证码错误"==e.msg?"图片验证码错误":e.msg,i.msg("提示:"+e.msg),o.attr("src",n.vCodeUrl+"?t="+(new Date).getTime())))})}})},o.prototype.disabledSendBtn=function(){var e=$("#jRegistGetCode"),n=this,t=setInterval(function(){n.seconds--,e.text(n.seconds+"秒后重试"),e.css({background:"#ccc",cursor:"default"}),0==n.seconds&&(clearInterval(t),n.seconds=60,e.text("获取验证码"),e.css("background","#e50541"),n.codeIsSend=!1)},1e3)},o.prototype.validate=function(){var e=this,n=$("#ffRegister"),o=$("#btnRegister"),s=n.validate({rules:{username:{required:!0,minlength:11,maxlength:11,iphone:!0},userpwd:{required:!0,minlength:8,maxlength:16},code:{required:!0,minlength:4,maxlength:6},vcode:{required:!0,minlength:4,maxlength:4}},messages:{username:{required:"手机号不能为空",minlength:"手机号长度需为11位",maxlength:"手机号长度需为11位",iphone:"手机号错误"},userpwd:{required:"密码不能为空",minlength:"密码仅支持8-16位数字、字母和符号",maxlength:"密码仅支持8-16位数字、字母和符号"},code:{required:"短信验证码不能为空",minlength:"短信验证码不正确",maxlength:"短信验证码不正确"},vcode:{required:"图片验证码不能为空",minlength:"图片验证码不正确",maxlength:"图片验证码不正确"}},errorPlacement:function(e,n){n.parents(".j-u-c-input").addClass("j-v-error").parents(".j-u-d-c-register").after(e)},success:function(e){var n=e.prev().find(".j-u-c-input");n.hasClass("j-v-error")&&n.removeClass("j-v-error"),e.remove()}});return o.on("click",function(){if(e.isAgree&&n.valid()){var o=$("#txtUserRegistTelephone"),a=$("#txtUserRegistPwd"),d=$("#txtUserRegistCode");s.resetForm();t.register(o.val(),a.val(),d.val()).then(function(e){console.log(e),e&&(1e3==e.code?(i.msg("注册成功"),ga("send","event","pc官网-点击注册","注册成功",""),window.location.reload()):(e.msg="验证码错误"==e.msg?"短信验证码错误":e.msg,i.msg("提示:"+e.msg)))})}}),n.keydown(function(n){e.isAgree&&13==n.keyCode&&o.trigger("click")}),s},o}),define("user",["dialog","module/user/login","module/user/register","module/user/user.info","services/util"],function(e,n,t,i,o){function s(){this.login=new n,this.register=new t}s.prototype._login=function(){var e=this;$("#jLogin").on("click",function(){e.login.open(),e._afterOpenLogin(),o.gaSend("pc官网-点击登录","登录界面","")})},s.prototype.openLogin=function(){var e=this;e.login.open(),e._afterOpenLogin()},s.prototype._afterOpenLogin=function(){var e=this;$("#jR_L_Register").unbind().on("click",function(){e.login.close(),e.register.open(),e._afterRegisterOpen(),o.gaSend("pc官网-点击注册","注册界面","")})},s.prototype._register=function(){var e=this;$("#jRegister").on("click",function(){e.register.open(),e._afterRegisterOpen(),o.gaSend("pc官网-点击注册","注册界面",""),console.log("注册注册")})},s.prototype._afterRegisterOpen=function(){var e=this;$("#jR_R_Login").unbind().on("click",function(){e.register.close(),e.login.open(),e._afterOpenLogin(),o.gaSend("pc官网-点击登录","登录界面","")})},window.JIE=window.JIE||{},JIE.openLoginDialog=function(){(new s).openLogin()},$(function(){$.validator.methods.iphone=function(e,n){return this.optional(n)||/^1\d{10}$/.test(e)};var e=new s;e._login(),e._register(),new i})}),require.config({baseUrl:"/static/js/",urlArgs:"ver=1.7",paths:{scrollUp:"http://wimg.spriteapp.cn/pc/common/jquery.scrollUp",dialog:"http://wimg.spriteapp.cn/pc/dialog/dialog",scrollPagination:"http://wimg.spriteapp.cn/pc/common/scrollpagination",jwplayer:"http://wimg.spriteapp.cn/pc/jwplayer/jwplayer",store:"http://wimg.spriteapp.cn/pc/common/store",slide:"http://wimg.spriteapp.cn/pc/superslide/jquery.SuperSlide.2.1.1.source",user:"module/user"},shim:{scrollUp:{exports:""},dialog:{exports:"dialog"},scrollPagination:{exports:""},jwplayer:{exports:"jwplayer"},slide:{exports:""}}}),require(["module/detail","user"]),define("config/detail.config",function(){});